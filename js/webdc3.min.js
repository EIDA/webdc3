(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){return new Promise(function(resolve,reject){function error(e){if(console.error!==wiConsole.error)console.error("config.js: "+e.message);wiConsole.error("config.js: "+e.message,e);reject()}try{var sr=typeof eidaServiceRoot==="undefined"?"wsgi/":eidaServiceRoot;window.configurationProxy=new ConfigurationProxy(sr);window.configurationProxy.reload().then(resolve).catch(error)}catch(e){error(e)}})};function ConfigurationProxy(url){var _url=undefined;var _cache={};this.reload=function(){return new Promise(function(resolve,reject){if(_url===undefined){reject(new Error("server URL is not defined"));return}_cache={};$.getJSON(_url+"configuration").done(function(data){_cache=data;resolve()}).fail(function(){reject(new Error("AJAX error"))})})};this.value=function(key,defaultValue){var current=_cache;var keys=key.split(".");for(var keyid in keys){var level=keys[keyid];if(current===null||current[level]===undefined){current=null;break}current=current[level]}if(current===null)return defaultValue;return current};this.serviceRoot=function(){return _url};if(!url){if(interfaceLoader.debug())console.error("config.js: Need a base server address to query for configuration parameters.");return}_url=url+(url[url.length-1]!=="/"?"/":"")}

},{}],2:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{window.wiConsole=new WIConsole("#wi-Console");if(window.console===undefined)window.console={};if(window.console.debug===undefined)window.console.debug=wiConsole.debug;if(window.console.info===undefined)window.console.info=wiConsole.info;if(window.console.log===undefined)window.console.log=wiConsole.notice;if(window.console.warn===undefined)window.console.warn=wiConsole.warning;if(window.console.error===undefined)window.console.error=wiConsole.error;window.onerror=function(errorMsg,url,lineNumber){if(interfaceLoader.debug())window.wiConsole.error(errorMsg+" ("+url+":"+lineNumber+")");else window.wiConsole.error(errorMsg)};resolve()}catch(e){alert("console.js: "+e.message);reject()}})};function WIConsole(htmlTagId){var _controlDiv=null;var _callback=null;var _maxMessages=100;var _level=0;var _msgClass="wi-console-debug";function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error("console.js: Cannot find a div with class '"+htmlTagId+"'");return}_controlDiv=control}function log(msgClass,msg,exc){var msgList=_controlDiv.children();if(!msgList.length){_controlDiv.append("<div align=\"right\"><a href=\"javascript:wiConsole.clear()\">Clear Console</a></div>")}if(msgList.length>=_maxMessages+1)msgList.eq(1).remove();var msgDiv=$("<div class=\""+msgClass+"\"/>");msgDiv.text(msg);_controlDiv.append(msgDiv);if(typeof exc!="undefined"&&typeof printStackTrace!="undefined"){var trace=printStackTrace({e:exc});for(var i in trace){if(msgList.length>=_maxMessages+1)msgList.eq(1).remove();msgDiv=$("<div class=\"wi-console-stacktrace\"/>");msgDiv.text(trace[i]);_controlDiv.append(msgDiv)}}_controlDiv.prop("scrollTop",_controlDiv.prop("scrollHeight"))}this.debug=function debug(msg,exc){var msgClass="wi-console-debug";if(_controlDiv){try{log(msgClass,msg,exc);return}catch(e){alert("console.js: "+e.message)}}if(console.debug!==debug)console.debug(msg)};this.info=function info(msg,exc){var msgClass="wi-console-info";if(_level<1){_level=1;_msgClass=msgClass;try{if(_callback)_callback(_level,msgClass)}catch(e){alert("console.js: "+e.message)}}if(_controlDiv){try{log(msgClass,msg,exc);return}catch(e){alert("console.js: "+e.message)}}if(console.info!==info)console.info(msg)};this.notice=function notice(msg,exc){var msgClass="wi-console-notice";if(_level<2){_level=2;_msgClass=msgClass;try{if(_callback)_callback(_level,msgClass)}catch(e){alert("console.js: "+e.message)}}if(_controlDiv){try{log(msgClass,msg,exc);return}catch(e){alert("console.js: "+e.message)}}if(console.log!==notice)console.log(msg)};this.warning=function warning(msg,exc){var msgClass="wi-console-warning";if(_level<3){_level=3;_msgClass=msgClass;try{if(_callback)_callback(_level,msgClass)}catch(e){alert("console.js: "+e.message)}}if(_controlDiv){try{log(msgClass,msg,exc);return}catch(e){alert("console.js: "+e.message)}}if(console.warn!==warning)console.warn(msg)};this.error=function error(msg,exc){var msgClass="wi-console-error";if(_level<4){_level=4;_msgClass=msgClass;try{if(_callback)_callback(_level,msgClass)}catch(e){alert("console.js: "+e.message)}}if(_controlDiv){try{log(msgClass,msg,exc);return}catch(e){alert("console.js: "+e.message)}}if(console.error!==error)console.error(msg)};this.clear=function(){_controlDiv.children().remove()};this.scrollToBottom=function(){_controlDiv.prop("scrollTop",_controlDiv.prop("scrollHeight"))};this.resetLevel=function(){_level=0;_msgClass="wi-console-debug"};this.level=function(){return _level};this.setCallback=function(callback){_callback=callback;_callback(_level,_msgClass)};load(htmlTagId)}

},{}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{window.eventSearchControl=new EventSearchControl("#wi-EventSearchControl");resolve()}catch(e){if(console.error!==wiConsole.error)console.error("events.js: "+e.message);wiConsole.error("events.js: "+e.message,e);reject()}})};function EventSearchControl(htmlTagId){var _controlDiv=null;var _catalogList=Array();function checkNumber(value,min,max){if(value==="")return null;value=Number(value);if(isNaN(value))return null;if(value<min)return null;if(value>max)return null;return value}function fillCatalogList(cataloglist){if(_controlDiv===null)return;if(!cataloglist)return;_catalogList=cataloglist;if(interfaceLoader.debug())console.error("Catalog rebuild");var select=_controlDiv.find("#escCatalog");select.empty();for(var key in _catalogList){var item=_catalogList[key];select.append("<option value=\""+key+"\">"+item.description+"</option>")}updateControlState()}function reloadCatalogs(){wiService.event.catalogs(fillCatalogList,null,true,{})}function validateCoordinates(){var bottom=_controlDiv.find("#escLatitudeMin").val();var top=_controlDiv.find("#escLatitudeMax").val();var left=_controlDiv.find("#escLongitudeMin").val();var right=_controlDiv.find("#escLongitudeMax").val();if(Number(bottom)>=Number(top)){alert("Invalid latitude interval.");return}if(Number(left)>=Number(right)){alert("Invalid longitude interval.");return}if(mapControl.enabled())mapControl.setSelect(bottom,left,top,right)}function resetCoordinates(){_controlDiv.find("#escLatitudeMin").val("-90");_controlDiv.find("#escLatitudeMax").val("90");_controlDiv.find("#escLongitudeMin").val("-180");_controlDiv.find("#escLongitudeMax").val("180");if(mapControl.enabled())mapControl.clearSelect()}function resetControl(){if(_controlDiv===null)return;var mag=configurationProxy.value("events.magnitudes.minimum",4);_controlDiv.find("#escMagnitudeSlider").slider("value",mag);var dmin=configurationProxy.value("events.depth.minimum",0);var dmax=configurationProxy.value("events.depth.maximum",1000);_controlDiv.find("#escDepthSlider").slider("values",[dmin,dmax]);var startoffset=configurationProxy.value("events.date.startoffset","-7d");_controlDiv.find("#escStart").datepicker("setDate",startoffset);_controlDiv.find("#escEnd").datepicker("setDate","now");_controlDiv.find("#escEventModeCatalog").click();resetCoordinates();return}function buildQueryURL(catalog,start,end,minmag,maxmag,mindepth,maxdepth,minlat,maxlat,minlon,maxlon,limit){var options={};options.catalog=undefined;options.start=undefined;options.end=undefined;options.minmag=undefined;options.maxmag=undefined;options.mindepth=undefined;options.maxdepth=undefined;options.minlat=undefined;options.minlon=undefined;options.maxlat=undefined;options.maxlon=undefined;options.limit=undefined;options.format="json";options.catalog=catalog;var catalogPrefs=_catalogList[catalog];if(!catalogPrefs){alert("Invalid Catalog.");return}if(catalogPrefs.hasDate){try{if(start!==undefined)start=$.datepicker.parseDate("yy-mm-dd",start)}catch(err){alert(start+" is not a valid start date ("+err+")");return}try{if(end!==undefined){end=$.datepicker.parseDate("yy-mm-dd",end);end.setDate(end.getDate()+1)}}catch(err){alert(end+" is not a valid end date ("+err+").");return}if(start>end){start=$.datepicker.formatDate("yy-mm-dd",start);end=$.datepicker.formatDate("yy-mm-dd",end);alert("Invalid date interval, "+start+" &gt; "+end+".");return}if(start!==null&start!==undefined)options.start=$.datepicker.formatDate("yy-mm-dd",start);if(end!==null&end!==undefined)options.end=$.datepicker.formatDate("yy-mm-dd",end)}if(catalogPrefs.hasMagnitude){if(minmag===null){alert(_controlDiv.find("#escMagnitudeSlider").slider("value")+" is invalid as magnitude.");return}if(minmag!==null)options.minmag=minmag;if(maxmag!==null)options.maxmag=maxmag}if(catalogPrefs.hasDepth){if(mindepth===null){alert(_controlDiv.find("#escDepthSlider").slider("values",0)+" is invalid as depth.");return}if(maxdepth===null){alert(_controlDiv.find("#escDepthSlider").slider("values",1)+" is invalid as depth.");return}if(mindepth>=maxdepth){alert("Invalid depth interval, "+mindepth+" >= "+maxdepth+".");return}if(mindepth!==null)options.mindepth=mindepth;if(maxdepth!==null)options.maxdepth=maxdepth}if(catalogPrefs.hasRectangle){if(minlat===null){alert(_controlDiv.find("#escLatitudeMin").val()+" is invalid as latitude.");return}if(maxlat===null){alert(_controlDiv.find("#escLatitudeMax").val()+" is invalid as latitude.");return}if(minlon===null){alert(_controlDiv.find("#escLongitudeMin").val()+" is invalid as longitude.");return}if(maxlon===null){alert(_controlDiv.find("#escLongitudeMax").val()+" is invalid as longitude.");return}if(minlat>=maxlat){alert("Invalid latitude interval, "+minlat+" >= "+maxlat+".");return}if(minlon>=maxlon&&maxlon!==null){alert("Invalid longitude interval, "+minlon+" >= "+maxlon+".");return}if(minlat!==null)options.minlat=minlat;if(minlon!==null)options.minlon=minlon;if(maxlat!==null)options.maxlat=maxlat;if(maxlon!==null)options.maxlon=maxlon;if(limit!==null)options.limit=limit}return options}function quick6(){if(!_controlDiv)return;var start=undefined;var end=undefined;var catalog=_controlDiv.find("#escCatalog").val();var mindepth=0.001;var maxdepth=999;var minlat=checkNumber(_controlDiv.find("#escLatitudeMin").val(),-90,90);var maxlat=checkNumber(_controlDiv.find("#escLatitudeMax").val(),-90,90);var minlon=checkNumber(_controlDiv.find("#escLongitudeMin").val(),-180,180);var maxlon=checkNumber(_controlDiv.find("#escLongitudeMax").val(),-180,180);var options=buildQueryURL(catalog,start,end,6,10,mindepth,maxdepth,minlat,maxlat,minlon,maxlon,10);if(typeof options==="undefined")return;wiService.event.query(function(data,statustext,jqxhr){if(jqxhr.status==204){alert("Got no events for the selected day and options");wiConsole.notice("Got no events for the selected day and options: "+$.param(options))}else{requestControl.appendEvent(data);_controlDiv.find("#escSearch").button("option","label","Append")}},null,true,options)}function query(){if(!_controlDiv)return;var start=_controlDiv.find("#escStart").val();var end=_controlDiv.find("#escEnd").val();var catalog=_controlDiv.find("#escCatalog").val();var minmag=checkNumber(_controlDiv.find("#escMagnitudeSlider").slider("value"),-2,10);var mindepth=checkNumber(_controlDiv.find("#escDepthSlider").slider("values",0),-15,1000);var maxdepth=checkNumber(_controlDiv.find("#escDepthSlider").slider("values",1),-15,1000);var minlat=checkNumber(_controlDiv.find("#escLatitudeMin").val(),-90,90);var maxlat=checkNumber(_controlDiv.find("#escLatitudeMax").val(),-90,90);var minlon=checkNumber(_controlDiv.find("#escLongitudeMin").val(),-180,180);var maxlon=checkNumber(_controlDiv.find("#escLongitudeMax").val(),-180,180);var options=buildQueryURL(catalog,start,end,minmag,10,mindepth,maxdepth,minlat,maxlat,minlon,maxlon,null);if(typeof options==="undefined")return;wiService.event.query(function(data,statustext,jqxhr){if(jqxhr.status==204){alert("Got no events for the selected day and options");wiConsole.notice("Got no events for the selected day and options: "+$.param(options))}else{requestControl.appendEvent(data);_controlDiv.find("#escSearch").button("option","label","Append")}},null,true,options)}function updateControlState(){return;var catalog=_catalogList[_controlDiv.find("#escCatalog option:selected").val()];if(catalog===undefined)return;_controlDiv.find("#escDepthSlider").slider(!catalog.hasDepth?"disable":"enable");_controlDiv.find("#escDepthMin").prop("disabled",!catalog.hasDepth);_controlDiv.find("#escDepthMax").prop("disabled",!catalog.hasDepth);_controlDiv.find("#escMagnitudeSlider").slider(!catalog.hasMagnitude?"disable":"enable");_controlDiv.find("#escMagnitudeValue").prop("disabled",!catalog.hasMagnitude);_controlDiv.find("#escStart").prop("disabled",!catalog.hasDate);_controlDiv.find("#escEnd").prop("disabled",!catalog.hasDate);_controlDiv.find("input[id*=escLatitude]").prop("disabled",!catalog.hasRectangle);_controlDiv.find("input[id*=escLongitude]").prop("disabled",!catalog.hasRectangle);_controlDiv.find("#escCoordinateReset").prop("disabled",!catalog.hasRectangle)}function parseUserCatalog(){var result={status:1,message:"FAIL",header:""};var time=Number($("#escColumnTime").val());var latitude=Number($("#escColumnLatitude").val());var longitude=Number($("#escColumnLongitude").val());var depth=Number($("#escColumnDepth").val());var nmax=Math.max(time,latitude,longitude,depth);var nmin=Math.min(time,latitude,longitude,depth);if(nmin<1||isNaN(nmax)){alert("Error: column indices must be integers starting from 1.");return result}var format="csv";var columns=Array();var input=$("#escCatalogInput").val();if(input===null||input===undefined||input===""){alert("Please paste your catalog inside the text area before pressing 'Send'.");return result}var col_indices=Array(time,latitude,longitude,depth);var col_tags=Array("time","latitude","longitude","depth");for(var i=0;i<nmax;i++){columns[i]="ignore"}for(var i=0;i<col_indices.length;i++){if(col_indices[i]===undefined){console.warn("Item "+i+":"+col_tags[i]+" is undefined")}}for(var i=0;i<col_tags.length;i++){var index=col_indices[i]-1;if(columns[index]==="ignore"){columns[index]=col_tags[i]}else{var msg="Error: "+columns[index]+" and "+col_tags[i]+" can't both be given in column "+(index+1)+".";alert(msg);var msg2="parseUserCatalog: indices were "+col_indices+"; "+columns.length+" columns: '"+columns+"')";console.log(msg2);columns=columns.toString();result={status:1,message:"Index problem",header:columns};return result}}columns=columns.toString();wiService.event.parse(function(data,statustext,jqxhr){if(jqxhr.status==204){alert("No events could be imported from the User catalog");wiConsole.notice("No events could be imported from the User catalog")}else{requestControl.appendEvent(data);_controlDiv.find("#escSearch").button("option","label","Append")}},null,true,format,columns,input);var br="\n";var msg="OK, params are:"+br;msg+=" format: '"+format+"'"+br;msg+=" columns: '"+columns+"'"+br;msg+=" input: '"+input+"'"+br;result={status:0,message:msg,header:columns};return result}function buildControl(){if(_controlDiv===null)return;var html="";html+="<h3>Event Information</h3>";html+="<div id=\"escEventMode\" align=\"center\">";html+="<input type=\"radio\" value=\"Catalog\" id=\"escEventModeCatalog\" name=\"escEventMode\" /><label for=\"escEventModeCatalog\">Catalog Services</label>";html+="<input type=\"radio\" value=\"File\" id=\"escEventModeFile\" name=\"escEventMode\" /><label for=\"escEventModeFile\">User Supplied</label>";html+="</div>";html+="<div id=\"escEventDiv\">";html+="<div style=\"padding: 8px;\" id=\"escEventCatalogDiv\"></div>";html+="<div style=\"padding: 8px; text-align: center;\" id=\"escEventFileDiv\"></div>";html+="</div>";html+="<div class=\"wi-control-item-last\">";html+="<input id=\"escReset\" class=\"wi-inline\" type=\"button\" value=\"Reset\" />";html+="<input id=\"escSearch\" class=\"wi-inline\" type=\"button\" value=\"Search\" />";html+="</div>";_controlDiv.append(html);requestControl.bind("onDeleteEvents",function(){_controlDiv.find("#escSearch").button("option","label","Search")});html="<div class=\"wi-control-item-first wi-short-div\">";html+="<div class=\"wi-short-spacer\">Catalog Service:</div>";html+="<div class=\"wi-short-right\"><select style=\"width: 100%;\" id=\"escCatalog\"></select></div>";html+="</div>";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\">Date Interval (yyyy-mm-dd):</div>";html+="<input style=\"position: relative; z-index: 100\" class=\"wi-inline\" type=\"text\" id=\"escStart\"  title=\"Start date in yyyy-mm-dd format.\"/>";html+="&ndash;<input style=\"position: relative; z-index: 100\" class=\"wi-inline\" type=\"text\" id=\"escEnd\" title=\"End date in yyyy-mm-dd format.\"/>";html+="</div>";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\">Minimum Magnitude:<input class=\"wi-inline-small\" id=\"escMagnitudeValue\" value=\"-\" title=\"Minimum allowed magnitude (-2.0 to 10.0)\" /></div>";html+="<div id=\"escMagnitudeSlider\"></div>";html+="</div>";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\">Depth from<input class=\"wi-inline-small\" id=\"escDepthMin\" value=\"\">to<input class=\"wi-inline-small\" id=\"escDepthMax\" value=\"\">km</div>";html+="<div id=\"escDepthSlider\"></div>";html+="</div>";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\">Coordinates: (Use -ve for S/W; +ve for N/E)</div>";html+="<div style=\"text-align: center;\">";html+="N<br/>";html+="<input style=\"text-align: center; width: 50px; margin: .5em;\" id=\"escLatitudeMax\" value=\"\" title=\"Northernmost latitude for the region of interest (-90&#176; to 90&#176;)\"><br/>";html+="W<input style=\"text-align: center; width: 50px; margin: .5em 1.5em .5em .5em;\" id=\"escLongitudeMin\" value=\"\" title=\"Westernmost longitude for the region of interest (-180 to 180&deg;)\">";html+="<input style=\"text-align: center; width: 50px; margin: .5em .5em .5em 1.5em;\" id=\"escLongitudeMax\" value=\"\" title=\"Easternmost longitude for the region of interest (-180 to 180 degrees)\"/>E<br/>";html+="<input style=\"text-align: center; width: 50px; margin: .5em;\" id=\"escLatitudeMin\" value=\"\" title=\"Southernmost latitude for the region of interest (-90&#176; to 90&#176;)\">";html+="<br/>S";html+="<input style=\"position: absolute; bottom: 2.0em; right: 0;\" type=\"button\" id=\"escCoordinateReset\" value=\"Clear\" />";html+="</div>";html+="</div>";_controlDiv.find("#escEventCatalogDiv").append(html);html="<div class=\"wi-spacer\"><input id=\"escUserCatalog\" class=\"wi-inline-full\" type=\"button\" value=\"Upload Catalog\" /></div>";_controlDiv.find("#escEventFileDiv").append(html);_controlDiv.find("#escEventMode").buttonset();_controlDiv.find("#escEventMode").change(function(item){_controlDiv.find("#escEventDiv").children("div").hide();_controlDiv.find("#escEvent"+$(item.target).val()+"Div").show()});html="<div id=\"escCatalogLoader\">";html+="<p style=\"margin: 5px 0 5px 0; font-size: 0.85em;\">Use this control to upload your personal event catalog to be processed by our system. The catalog should be in CSV (comma-separated value) format and may contain as many events as you want, one per line, with the same number of columns. You must also indicate which columns contain the Latitude, Longitude, Depth and Origin Time for the event. All other columns will be ignored.</p>";html+="<p><i>Example:</i> <tt>2011-03-11T05:46:23;38.23;142.53;15;Tohoku</tt></p>";html+="<br/><h3>Column Number Specification:</h3>";html+="<div>";html+="Time: <input class=\"wi-inline-small\" id=\"escColumnTime\" value=\"1\" />";html+="Latitude: <input class=\"wi-inline-small\" id=\"escColumnLatitude\" value=\"2\"/>";html+="Longitude: <input class=\"wi-inline-small\" id=\"escColumnLongitude\" value=\"3\"/>";html+="Depth: <input class=\"wi-inline-small\" id=\"escColumnDepth\" value=\"4\"/>";html+="</div>";html+="<br/><h3>Copy and paste your catalog into the area below:</h3>";html+="<div id=\"escCatalogHeader\">[No format specified. Press \"Send\" first.]</div><br>";html+="<div style=\"margin: 5px 0 10px 0;\"><textarea style=\"width: 100%; height: 4em;\" id=\"escCatalogInput\">2011-03-11T05:46:23;38.23;142.53;15;Tohoku</textarea></div>";html+="</div>";$("body").append(html);$("body").find("#escCatalogLoader").dialog({title:"Catalog Input Dialog",autoOpen:false,height:450,width:550,modal:true,buttons:{Send:function Send(){alert("Thank you, your upload is being checked.");var result=parseUserCatalog();console.log("parseUserCatalog: "+result.message);if(result.header!==undefined){var text="Format: "+result.header;$("body").find("#escCatalogHeader").empty().append(text)}},Close:function Close(){$(this).dialog("close")}}});_controlDiv.find("#escUserCatalog").button().bind("click",function(){$("#escCatalogLoader").dialog("open")});_controlDiv.find("#escSearch").button().bind("click",query);_controlDiv.find("#escQuick6").button().bind("click",quick6);_controlDiv.find("#escReset").button().bind("click",resetControl);_controlDiv.find("#escCatalog").bind("click",updateControlState);_controlDiv.find("#escStart").datepicker({showButtonPanel:true,changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd"});_controlDiv.find("#escEnd").datepicker({showButtonPanel:true,changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd"});_controlDiv.find("#escDepthSlider").slider({range:true,min:0,max:1000,step:1,slide:function slide(event,ui){_controlDiv.find("#escDepthMin").val(ui.values[0]);_controlDiv.find("#escDepthMax").val(ui.values[1])},change:function change(event,ui){_controlDiv.find("#escDepthMin").val(ui.values[0]);_controlDiv.find("#escDepthMax").val(ui.values[1])}});_controlDiv.find("#escDepthMin").bind("change",function(obj){var values=_controlDiv.find("#escDepthSlider").slider("values");values[0]=$(obj.target).val();_controlDiv.find("#escDepthSlider").slider("values",values)});_controlDiv.find("#escDepthMax").bind("change",function(obj){var values=_controlDiv.find("#escDepthSlider").slider("values");values[1]=$(obj.target).val();_controlDiv.find("#escDepthSlider").slider("values",values)});_controlDiv.find("#escMagnitudeSlider").slider({min:-2,max:10,step:0.1,slide:function slide(event,ui){_controlDiv.find("#escMagnitudeValue").val(ui.value)},change:function change(event,ui){_controlDiv.find("#escMagnitudeValue").val(ui.value)}});_controlDiv.find("#escMagnitudeValue").bind("change",function(obj){_controlDiv.find("#escMagnitudeSlider").slider("value",$(obj.target).val())});_controlDiv.find("input[id*=escLatitude]").bind("change",function(item){var value=checkNumber($(item.target).val(),-90,90);if(value===null){alert("Invalid latitude value, "+$(item.target).val());$(item.target).val("");return}validateCoordinates()});_controlDiv.find("input[id*=escLongitude]").bind("change",function(item){var value=checkNumber($(item.target).val(),-180,180);if(value===null){alert("Invalid longitude value, "+$(item.target).val());$(item.target).val("");return}validateCoordinates()});_controlDiv.find("#escCoordinateReset").button().bind("click",resetCoordinates)}function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error("event.js: Cannot find a div with class '"+htmlTagId+"'");return}_controlDiv=control;buildControl();if(typeof mapControl!=="undefined"){mapControl.bind("onChangeExtend",function(bottom,left,top,right){_controlDiv.find("#escLatitudeMax").val(top);_controlDiv.find("#escLatitudeMin").val(bottom);_controlDiv.find("#escLongitudeMax").val(right);_controlDiv.find("#escLongitudeMin").val(left)})}resetControl();reloadCatalogs()}load(htmlTagId)}

},{}],4:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{var div=$('#wi-FDSNWS-Control');if(!div.length){window.wiFDSNWS_Control=new FDSNWS_Dummy;resolve();return}var fdsnws=new FDSNWS_Control(div);wiConsole.info('fdsnws.js: initializing');fdsnws.init().then(function(){wiConsole.info('fdsnws.js: init successful');window.wiFDSNWS_Control=fdsnws;resolve()}).catch(function(e){if(e instanceof Error)wiConsole.error('fdsnws.js: '+e.message,e);wiConsole.info('fdsnws.js: init failed');div.parent().remove();window.wiFDSNWS_Control=new FDSNWS_Dummy;resolve()})}catch(e){if(console.error!==wiConsole.error)console.error('fdsnws.js: '+e.message);wiConsole.error('fdsnws.js: '+e.message,e);reject()}})};function ajaxErrorMessage(jqXHR,textStatus){if(jqXHR.statusText)return jqXHR.statusText;else return textStatus}function FDSNWS_Download(controlDiv,db,authToken,data,options,bulk,merge,contentType,filename,cbDownloadFinished){var pbarDiv=null;var saveButton=null;var handle=null;var cred=null;var stopped=true;var n=0;function buildControl(){var pbarWrapperDiv=$('<div class="wi-status-full-group-buttons"/>');var popupDiv=$('<div class="wi-status-popup"/>').attr('title',data.url);var popupBodyDiv=$('<div class="wi-status-popup-group-body"/>');var popupTable=$('<table/>');pbarDiv=$('<div style="cursor:pointer"/>');pbarDiv.append($('<div class="wi-progress-label"/>').text(data.url).append(' - <span class="wi-download-counter">0</span>/'+data.params.length+' time windows'));pbarDiv.progressbar().click(function(){popupDiv.dialog('open')});pbarWrapperDiv.append(pbarDiv);if(!merge){var pbarButtonDiv=$('<div style="float:right"/>');pbarDiv.css('width','86%').css('float','left');saveButton=$('<a class="wi-inline" type="button">Save</a>');saveButton.button({disabled:true});pbarButtonDiv.append(saveButton);pbarWrapperDiv.append(pbarButtonDiv);pbarWrapperDiv.append('<div style="clear:both"/>')}popupBodyDiv.append(popupTable);popupDiv.append(popupBodyDiv);controlDiv.append(pbarWrapperDiv);controlDiv.append(popupDiv);popupDiv.dialog({autoOpen:false,modal:true,width:600});$.each(data.params,function(i,p){var row=$('<tr id="wi-download-status-'+p.id+'"/>');row.append($('<td>').text(p.net));row.append($('<td>').text(p.sta));row.append($('<td>').text(p.loc));row.append($('<td>').text(p.cha));row.append($('<td>').text(p.start));row.append($('<td>').text(p.end));row.append($('<td class="wi-download-status-code">'));row.append($('<td class="wi-download-status-text">'));popupTable.append(row)})}function store(blob,id){var t=db.transaction(['blobs'],'readwrite');t.objectStore('blobs').put(blob,id);t.oncomplete=next;t.onerror=cbDownloadFinished}function status(id,code,text){var tr=$('#wi-download-status-'+id);var tdcode=tr.find('.wi-download-status-code');var tdtext=tr.find('.wi-download-status-text');switch(code){case'OK':tr.css('color','green');break;case'NODATA':tr.css('color','orange');break;case'ERROR':tr.css('color','red');break;}tdcode.text(code);if(text&&text!='error')tdtext.text(text)}function statusBulk(code,text){$.each(data.params,function(i,p){status(p.id,code,text)})}function fetchBulk(){var postData='';$.each(Object.keys(options),function(i,k){postData+=k+'='+options[k]+'\n'});$.each(data.params,function(i,p){postData+=p.net+' '+p.sta+' '+p.loc+' '+p.cha+' '+p.start+' '+p.end+'\n'});handle=$.ajax({method:'POST',url:data.url,data:postData,contentType:'text/plain',dataType:'native',processData:false,xhrFields:{responseType:'arraybuffer'}});handle.done(function(buf,textStatus,jqXHR){handle=null;if(jqXHR.status!=200)buf=new ArrayBuffer(0);var blob=new Blob([buf]);if(blob.size>0)statusBulk('OK');else statusBulk('NODATA');store(blob,data.id)});handle.fail(function(jqXHR,textStatus){handle=null;if(!stopped)statusBulk('ERROR',ajaxErrorMessage(jqXHR,textStatus));next()})}function processBulk(){var t=db.transaction(['blobs']);t.objectStore('blobs').get(data.id).onsuccess=function(event){var blob=event.target.result;if(blob==null){fetchBulk()}else{if(blob.size>0)statusBulk('OK');else statusBulk('NODATA');next()}};t.onerror=function(event){fetchBulk(p)}}function doAjax(ajax,url,p,username,password){var q=$.extend({},p);delete q['id'];delete q['priority'];handle=ajax({method:'GET',url:url+'?'+$.param(q),username:username,password:password,dataType:'native',processData:false,xhrFields:{responseType:'arraybuffer'}});handle.done(function(buf,textStatus,jqXHR){handle=null;if(jqXHR.status!=200)buf=new ArrayBuffer(0);var blob=new Blob([buf]);if(blob.size>0)status(p.id,'OK',blob.size+' bytes');else status(p.id,'NODATA');store(blob,p.id)});handle.fail(function(jqXHR,textStatus){handle=null;if(jqXHR.status==401){auth(p);return}if(!stopped)status(p.id,'ERROR',ajaxErrorMessage(jqXHR,textStatus));next()})}function auth(p){var url=data.url.replace(/^http:/,'https:').replace(/query$/,'auth');handle=$.ajax({type:'POST',url:url,data:authToken,contentType:'text/plain',dataType:'text'});handle.done(function(data){handle=null;cred=data;fetch(p)});handle.fail(function(jqXHR,textStatus){handle=null;if(stopped){cbDownloadFinished();return}wiConsole.error('fdsnws.js: '+url+': '+ajaxErrorMessage(jqXHR,textStatus));authToken=null;cred=null;fetch(p)})}function wadl(p){var url=data.url.replace(/query$/,'application.wadl');handle=$.ajax({type:'GET',url:url,dataType:'xml'});handle.done(function(xml){handle=null;if($(xml).find('resource[path="auth"]').length){auth(p);return}wiConsole.info('fdsnws.js: '+url+': authentication is not supported');authToken=null;cred=null;fetch(p)});handle.fail(function(jqXHR,textStatus){handle=null;if(stopped){cbDownloadFinished();return}wiConsole.error('fdsnws.js: '+url+': '+ajaxErrorMessage(jqXHR,textStatus));authToken=null;cred=null;fetch(p)})}function fetch(p){var url=data.url;if(authToken&&!cred){wadl(p)}else if(cred){var userpass=cred.split(':');url=url.replace(/query$/,'queryauth');doAjax($.ajaxDigest,url,p,userpass[0],userpass[1])}else{doAjax($.ajax,url,p)}}function process(p){var t=db.transaction(['blobs']);t.objectStore('blobs').get(p.id).onsuccess=function(event){var blob=event.target.result;if(blob==null){fetch(p)}else{if(blob.size>0)status(p.id,'OK',blob.size+' bytes');else status(p.id,'NODATA');next()}};t.onerror=function(event){fetch(p)}}function getProduct(cbResult){if(bulk){var t=db.transaction(['blobs']);t.objectStore('blobs').get(data.id).onsuccess=function(event){var blob=event.target.result;if(blob!=null)cbResult(blob);else cbResult(new Blob([]))};t.onerror=function(event){cbResult(new Blob([]))}}else{var parts=[];(function addPart(i){if(i<n){var t=db.transaction(['blobs']);t.objectStore('blobs').get(data.params[i].id).onsuccess=function(event){var blob=event.target.result;if(blob!=null)parts.push(blob);addPart(i+1)};t.onerror=function(event){addPart(i+1)}}else{cbResult(new Blob(parts))}})(0)}}function deliverProduct(blob){if(blob.size>0){var file=new File([blob],filename,{type:contentType});var url=URL.createObjectURL(file);saveButton.attr('href',url);saveButton.attr('download',filename);saveButton.button('enable')}cbDownloadFinished()}function retrieveProduct(){if(saveButton)getProduct(deliverProduct);else cbDownloadFinished()}function next(){if(stopped){retrieveProduct();return}pbarDiv.progressbar('value',100*n/data.params.length);pbarDiv.find('.wi-download-counter').text(n);if(n<data.params.length){if(bulk){processBulk();n+=data.params.length}else{process(data.params[n]);++n}}else{retrieveProduct()}}function start(){if(saveButton)saveButton.button('disable');stopped=false;n=0;next()}function stop(){stopped=true;if(handle!=null)handle.abort()}buildControl();this.start=start;this.stop=stop;this.getProduct=getProduct}function FDSNWS_Request(controlDiv,db,authToken,filename){var downloadsDiv=null;var stopButton=null;var startButton=null;var saveButton=null;var deleteButton=null;var data=null;var downloads=[];var finished=0;function buildControl(){var buttonsDiv=$('<div class="wi-status-full-group-buttons">');var filenameDiv=$('<div class="wi-status-full-group-buttons"/>').text(filename);startButton=$('<input class="wi-inline" type="button" value="Start"/>');startButton.button({disabled:true}).click(function(){start()});stopButton=$('<input class="wi-inline" type="button" value="Stop"/>');stopButton.button({disabled:true}).click(function(){stop()});saveButton=$('<a class="wi-inline" type="button">Save</a>');saveButton.button({disabled:true});deleteButton=$('<input class="wi-inline" type="button" value="Delete"/>');deleteButton.button({disabled:true}).click(function(){purge()});buttonsDiv.append(startButton);buttonsDiv.append(stopButton);buttonsDiv.append(saveButton);buttonsDiv.append(deleteButton);downloadsDiv=$('<div>Routing in progress...</div>');controlDiv.append(buttonsDiv);controlDiv.append(filenameDiv);controlDiv.append(downloadsDiv)}function deliverProduct(blobs){var file=new File(blobs,data.filename,{type:data.contentType});if(file.size>0){var url=URL.createObjectURL(file);saveButton.attr('href',url);saveButton.attr('download',data.filename);saveButton.button('enable')}startButton.button('enable');stopButton.button('disable');deleteButton.button('enable')}function retrieveProduct(){var blobs=[];$.each(downloads,function(i,dl){dl.getProduct(function(blob){blobs.push(blob);if(blobs.length==downloads.length)deliverProduct(blobs)})})}function cbDownloadFinished(){if(++finished<data.length)return;if(data.merge){retrieveProduct()}else{startButton.button('enable');stopButton.button('disable');saveButton.button('disable');deleteButton.button('enable')}}function revokeObjectUrls(){controlDiv.find('a[type=button]').each(function(i,button){var url=$(button).attr('href');if(url){URL.revokeObjectURL(url);$(button).removeAttr('href')}})}function start(){startButton.button('disable');stopButton.button('enable');saveButton.button('disable');deleteButton.button('disable');revokeObjectUrls();if(downloadsDiv.is(':empty')){$.each(data,function(i,d){var dlDiv=$('<div/>');var dot=data.filename.lastIndexOf('.');var filename=data.filename.slice(0,dot)+'_'+i+data.filename.slice(dot);var dl=new FDSNWS_Download(dlDiv,db,authToken,d,data.options,data.bulk,data.merge,data.contentType,filename,cbDownloadFinished);downloadsDiv.append(dlDiv);downloads.push(dl)})}finished=0;$.each(downloads,function(i,dl){dl.start()})}function stop(){$.each(downloads,function(i,dl){dl.stop()})}function purge(){revokeObjectUrls();controlDiv.remove();var t=db.transaction(['blobs'],'readwrite');$.each(data,function(i,d){t.objectStore('blobs').delete(d.id);$.each(d.params,function(i,p){t.objectStore('blobs').delete(p.id)})});t.oncomplete=function(event){var t=db.transaction(['requests'],'readwrite');t.objectStore('requests').delete(data.id)}}function create(){var t=db.transaction(['blobs'],'readwrite');$.each(data,function(i,d){t.objectStore('blobs').add(null).onsuccess=function(event){d.id=event.target.result};$.each(d.params,function(i,p){t.objectStore('blobs').add(null).onsuccess=function(event){p.id=event.target.result}})});t.oncomplete=function(event){var t=db.transaction(['requests'],'readwrite');t.objectStore('requests').add(data).onsuccess=function(event){data.id=event.target.result};t.oncomplete=start}}function load(d){data=d;downloadsDiv.empty()}buildControl();this.start=start;this.stop=stop;this.purge=purge;this.create=create;this.load=load}function FDSNWS_Control(controlDiv){var statusListDiv=null;var callback=null;var db=null;var authToken=null;var authInfo=null;function buildControl(){statusListDiv=$('<div class="wi-status-list-body"/>');controlDiv.append(statusListDiv)}function createObjectStores(db){db.createObjectStore('user');db.createObjectStore('requests',{autoIncrement:true,keyPath:'id'});db.createObjectStore('blobs',{autoIncrement:true})}function openDatabase(){return new Promise(function(resolve,reject){if(!window.indexedDB){wiConsole.error('fdsnws.js: IndexedDB is not supported by browser');reject();return}var dbOpenReq;var dbVersion=1;try{dbOpenReq=window.indexedDB.open('webdc',{version:dbVersion,storage:'persistent'})}catch(e){if(e instanceof TypeError){try{dbOpenReq=window.indexedDB.open('webdc',dbVersion)}catch(e){reject(e);return}}else{reject(e);return}}dbOpenReq.onsuccess=function(event){db=event.target.result;db.onerror=function(event){wiConsole.error('fdsnws.js: IndexedDB error (errorCode='+event.target.errorCode+')')};if(db.setVersion){if(db.version!=dbVersion){db.setVersion(dbVersion).onsuccess=function(){try{createObjectStore(db)}catch(e){reject(e)}}}}resolve()};dbOpenReq.onupgradeneeded=function(event){try{createObjectStores(event.target.result)}catch(e){reject(e)}};dbOpenReq.onerror=function(event){wiConsole.error('fdsnws.js: access to database denied');reject()}})}function loadAuthToken(){return new Promise(function(resolve,reject){var t=db.transaction(['user']);t.objectStore('user').get('auth').onsuccess=function(event){if(event.target.result){setAuthToken(event.target.result)}};t.oncomplete=resolve;t.onerror=reject})}function loadRequests(){return new Promise(function(resolve,reject){var t=db.transaction(['requests']);t.objectStore('requests').openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){var reqDiv=$('<div class="wi-status-full-group"/>');var data=cursor.value;var req=new FDSNWS_Request(reqDiv,db,authToken,data.filename);statusListDiv.append(reqDiv);req.load(data);req.start();cursor.continue()}};t.oncomplete=resolve;t.onerror=reject})}function init(){return openDatabase().then(loadAuthToken).then(loadRequests)}function submitRequest(param){var reqDiv=$('<div class="wi-status-full-group"/>');var req=new FDSNWS_Request(reqDiv,db,authToken,param.filename);statusListDiv.append(reqDiv);callback();var timewindows=JSON.parse(param.timewindows);if(routing){var postData='service='+param.service+'\nformat=json\n';$.each(timewindows,function(i,item){var start=item[0];var end=item[1];var net=item[2];var sta=item[3];var cha=item[4];var loc=item[5];if(loc=='')loc='--';postData+=net+' '+sta+' '+loc+' '+cha+' '+start+' '+end+'\n'});$.ajax({type:'POST',url:routerURL,data:postData,contentType:'text/plain',dataType:'json',success:function success(reqData){if(!reqData){wiConsole.error('fdsnws.js: no routes received');reqDiv.remove();return}reqData.options=param.options;reqData.bulk=param.bulk;reqData.merge=param.merge;reqData.filename=param.filename;reqData.contentType=param.contentType;req.load(reqData);req.create()},error:function error(jqXHR,textStatus){wiConsole.error('fdsnws.js: routing failed: '+ajaxErrorMessage(jqXHR,textStatus));reqDiv.remove()}})}else{var reqData=[{url:fdsnwsURL+'/'+param.service+'/1/'+(param.service=='dataselect'?'queryauth':'query'),name:param.service,params:[]}];$.each(timewindows,function(i,item){var start=item[0];var end=item[1];var net=item[2];var sta=item[3];var cha=item[4];var loc=item[5];if(loc=='')loc='--';reqData[0]['params'].push({net:net,sta:sta,loc:loc,cha:cha,start:start,end:end})});reqData.options=param.options;reqData.bulk=param.bulk;reqData.merge=true;reqData.filename=param.filename;reqData.contentType=param.contentType;req.load(reqData);req.create()}}function setCallback(cb){callback=cb}function setAuthToken(tok){if(!tok){var t=db.transaction(['user'],'readwrite');t.objectStore('user').delete('auth');authToken=null;authInfo=null;return}try{var text=openpgp.message.readArmored(tok).getText();if(!text){try{text=openpgp.cleartext.readArmored(tok).getText()}catch(e){wiConsole.error('fdsnws.js: invalid auth token: No auth data');return}}var auth=$.parseJSON(text);var t=db.transaction(['user'],'readwrite');t.objectStore('user').put(tok,'auth');authToken=tok;authInfo={userId:auth.mail,validUntil:new Date(auth.valid_until)}}catch(e){wiConsole.error('fdsnws.js: invalid auth token: '+e.message)}}function getAuthInfo(){return authInfo}buildControl();var routing=configurationProxy.value('fdsnws.routing','true')=='true';var routerURL=configurationProxy.value('fdsnws.routerURL','/eidaws/routing/1/query');var fdsnwsURL=configurationProxy.value('fdsnws.fdsnwsURL','/fdsnws').replace(/\/+$/,'');this.init=init;this.submitRequest=submitRequest;this.setCallback=setCallback;this.setAuthToken=setAuthToken;this.getAuthInfo=getAuthInfo}function FDSNWS_Dummy(){this.setCallback=function(){};this.setAuthToken=function(){};this.getAuthInfo=function(){}}

},{}],5:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{interface_init();resolve()}catch(e){if(console.error!==wiConsole.error)console.error('interface.js: '+e.message);wiConsole.error('interface.js: '+e.message,e);reject()}})};function interface_swap(obj){var parent=$(obj.target).parent().parent();var frame=parent.children('.frame');if(frame.css('display')==='block'){frame.toggle()}else{$('.canhide').children('.frame').hide();frame.toggle()}}function interface_init(){var tabControl=$('#wi-TabControl');tabControl.buttonset();tabControl.css('display','block');tabControl.change(function(item){$('#contents').children().children('.tab').css('display','none');$('#contents').children().children('.'+$(item.target).val()).css('display','block');if($(item.target).val()=='console'){wiConsole.scrollToBottom();wiConsole.resetLevel();$('#wi-ConsoleLabel').removeClass('wi-console-warning-tab');$('#wi-ConsoleLabel').removeClass('wi-console-error-tab')}else if($(item.target).val()=='download'){$('#wi-DownloadLabel').removeClass('wi-download-alert-tab')}});if(wiConsole.level()<=2){$('#wi-EventExplorerTab').prop('checked',true);$('#wi-EventExplorerTab').change()}else{$('#wi-ConsoleTab').prop('checked',true);$('#wi-ConsoleTab').change()}wiConsole.setCallback(function(level,msgClass){if((msgClass=='wi-console-warning'||msgClass=='wi-console-error')&&$('#wi-Console').is(':hidden'))$('#wi-ConsoleLabel').addClass(msgClass+'-tab');else wiConsole.resetLevel()});wiFDSNWS_Control.setCallback(function(){if($('#wi-FDSNWS-Control').is(':hidden'))$('#wi-DownloadLabel').addClass('wi-download-alert-tab')});$('.canhide').find('.help').bind('click',interface_swap);$('.canhide').find('.help').css('cursor','pointer');$('.canhide').find('h2').bind('click',interface_swap);$('.canhide').find('h2').css('cursor','pointer');$('.canhide').children('.frame').toggle()}

},{}],6:[function(require,module,exports){
'use strict';var _console=require('./console');var _console2=_interopRequireDefault(_console);var _config=require('./config');var _config2=_interopRequireDefault(_config);var _mapping=require('./mapping');var _mapping2=_interopRequireDefault(_mapping);var _service=require('./service');var _service2=_interopRequireDefault(_service);var _fdsnws=require('./fdsnws');var _fdsnws2=_interopRequireDefault(_fdsnws);var _request=require('./request');var _request2=_interopRequireDefault(_request);var _events=require('./events');var _events2=_interopRequireDefault(_events);var _station=require('./station');var _station2=_interopRequireDefault(_station);var _submit=require('./submit');var _submit2=_interopRequireDefault(_submit);var _review=require('./review');var _review2=_interopRequireDefault(_review);var _interface=require('./interface');var _interface2=_interopRequireDefault(_interface);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var VERSION='1.2 (2019.191)';window.WIError=function(message){this.name=undefined;this.message=message;this.toString=function(){return this.message}};window.WIError.prototype=new Error;window.interfaceLoader=new function(){this.debug=function(){return typeof eidaDebug!='undefined'?eidaDebug:true}};$(document).ready(function(){(0,_console2.default)().then(function(){wiConsole.info('Loading webinterface v'+VERSION+'...')}).then(_config2.default).then(_mapping2.default).then(_service2.default).then(_fdsnws2.default).then(_request2.default).then(_events2.default).then(_station2.default).then(_submit2.default).then(_review2.default).then(_interface2.default).then(function(){wiConsole.info('Ready.')}).catch(function(){wiConsole.info('Aborted.')})});

},{"./config":1,"./console":2,"./events":3,"./fdsnws":4,"./interface":5,"./mapping":7,"./request":8,"./review":9,"./service":10,"./station":11,"./submit":12}],7:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{window.mapControl=new MapControl("#wi-MappingControl");resolve()}catch(e){if(console.error!==wiConsole.error)console.error("mapping.js: "+e.message);wiConsole.error("mapping.js: "+e.message,e);reject()}})};function MapControl(htmlTagId){var that=this;var _callbacks={};var _controlDiv=null;var _map=null;var _wgs84="EPSG:4326";var _items=undefined;var _event_styles={};var _station_styles={};var _edges=undefined;function resetZoom(bounds){if(!_map)return;if(typeof bounds==="undefined")_map.zoomToMaxExtent();else _map.zoomToExtent(bounds,true)}function makeWMSlayer(serverURL,layerName){if(!serverURL)return;if(!layerName)return;var layer=new OpenLayers.Layer.WMS(layerName+"from "+serverURL,serverURL,{layers:layerName},{maxExtent:new OpenLayers.Bounds(-230,-95,230,95),maxResolution:"auto"});return layer}function makeGoogleLayer(layerName){if(!layerName)return;var options=undefined;if(layerName==="Google Satellite"){options={type:google.maps.MapTypeId.SATELLITE,numZoomLevels:22}}else if(layerName==="Google Physical"){options={type:google.maps.MapTypeId.TERRAIN,numZoomLevels:20}}else if(layerName==="Google Hybrid"){options={type:google.maps.MapTypeId.HYBRID,numZoomLevels:22}}else{layerName="Google Street";options={numZoomLevels:20,visibility:false}}var layer=new OpenLayers.Layer.Google(layerName,options);return layer}function makeOSMLayer(layerName){if(!layerName)return;return new OpenLayers.Layer.OSM(layerName)}function roundLatLon(x){return Math.round(x*100)/100}function makeMousePosition(digits){var control=new OpenLayers.Control.MousePosition({displayProjection:_wgs84,numDigits:digits});return control}function makeVectorLayer(){var options={projection:_map.displayProjection};var layer=new OpenLayers.Layer.Vector("Events",options);return layer}function getCallbacks(name){if(typeof _callbacks[name]==="undefined")return[];return _callbacks[name]}function makeSelector(){var control=new OpenLayers.Control({draw:function draw(){this.hbox=new OpenLayers.Handler.Box(control,{"done":this.notice},{"keyMask":OpenLayers.Handler.MOD_SHIFT});this.hbox.activate()},notice:function notice(bounds){var lb=_map.getLonLatFromPixel(new OpenLayers.Pixel(bounds.left,bounds.bottom));var rt=_map.getLonLatFromPixel(new OpenLayers.Pixel(bounds.right,bounds.top));lb.transform(_map.getProjection(),_wgs84);rt.transform(_map.getProjection(),_wgs84);lb.lon=roundLatLon(lb.lon);lb.lat=roundLatLon(lb.lat);rt.lon=roundLatLon(rt.lon);rt.lat=roundLatLon(rt.lat);that.setSelect(lb.lat,lb.lon,rt.lat,rt.lon)}});return control}function makeLimitBox(){var layer=new OpenLayers.Layer.Vector("Selection Limit");layer.setOpacity(0.3);return layer}function disableMouseWheel(){var controls=_map.getControlsByClass("OpenLayers.Control.Navigation");for(var i=0;i<controls.length;++i){controls[i].disableZoomWheel()}}function legendItem(flag,text){var html="";console.error(eidaCSSSource);html+="<td><img src=\""+eidaCSSSource+"/"+flag+".png\" title=\""+text+"\" width=\"15\" height=\"15\"></td><td>"+text+"</td>";return html}function legend(){var html="";html+="<h3>Stations</h3>";html+="<table cellspacing='5'>";html+="<tr>";html+=legendItem("op","Open and permanent");html+=legendItem("rp","Restricted and permanent");html+="</tr>";html+="<tr>";html+=legendItem("ot","Open and temporary");html+=legendItem("rt","Restricted and temporary");html+="</tr>";html+="<tr>"+legendItem("uu","Uncategorized Station")+"<td colspan='2'>&nbsp;</td></tr>";html+="</table>";html+="<h3>Events</h3>";html+="<table cellspacing='5'>";html+="<tr>";html+=legendItem("evdefault","Magnitude &lt; 6.0");html+=legendItem("evbig","Magnitude &ge; 6.0");html+="</tr>";html+="</table>";return html}function makeMap(){if(_controlDiv===null)return;_controlDiv.empty();var html="";html+="<div id=\"MapControlMap\"></div>";html+="<div style=\"float: left;\">Use left SHIFT + drag mouse to select regions.</div>";html+="<div style=\"float: right;\"><a href=\"javascript:mapControl.showHelp();\">Help</a></div>";html+="<div style=\"float: right;\"><a href=\"javascript:mapControl.showLegend();\">";html+="Legend</a>&nbsp;</div>";html+="<br class=\"clear\"/>";_controlDiv.append(html);_controlDiv.find("#MapControlMap").css("padding","0");_controlDiv.find("#MapControlMap").css("height","300px");_controlDiv.find("#MapControlMap").css("z-index",0);_controlDiv.find("#MapControlMap").css("position","relative");_controlDiv.find("#MapControlMap").width(_controlDiv.width());_controlDiv.find("#MapControlLegend").css("border","0px Solid black");_controlDiv.find("#MapControlLegend").css("margin-top","5px");_controlDiv.find("#MapControlLegend").css("min-height","50px");_controlDiv.find("#MapControlLegend").css("padding","5px 0 5px 0");var controls=[];var layers=[];var maptype=configurationProxy.value("maptype",null);_map=new OpenLayers.Map("MapControlMap",{controls:[]});if(maptype==="wms"){layers.push(makeWMSlayer(configurationProxy.value("wms.server",null),configurationProxy.value("wms.layer",null)))}else if(maptype==="google"){if(typeof google==="undefined"){throw new WIError("mapping.js: No Google maps available.");return}else{layers.push(makeGoogleLayer(configurationProxy.value("google.layer",null)))}}else if(maptype==="osm"){layers.push(makeOSMLayer("OSMLayer"))}else{throw new WIError("mapping.js: Whoa! Improper maptype value in the configuration")}controls.push(new OpenLayers.Control.PanPanel);controls.push(new OpenLayers.Control.ZoomPanel);controls.push(new OpenLayers.Control.Navigation);controls.push(makeMousePosition(2));controls.push(makeSelector());_items=makeVectorLayer();layers.push(_items);var _itsel=new OpenLayers.Control.SelectFeature(_items);controls.push(_itsel);_items.events.on({"featureselected":onItemSelect,"featureunselected":onItemUnselect});_edges=makeLimitBox();layers.push(_edges);_map.addControls(controls);_map.addLayers(layers);disableMouseWheel();resetZoom();var loc=_controlDiv.find(".olControlMousePosition");loc.css("color","#00589C");loc.css("background-color","#aaaaaa80");loc.css("height","1.4em");loc.css("min-width","7em");loc.css("padding","2px");loc.css("font-size","larger");loc.css("font-weight","bold");loc.css("text-align","center");loc.css("top","10px");_itsel.activate()}function probemap(){if(_controlDiv.width()===0){setTimeout(probemap,500);return}makeMap()}function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error("mapping.js: Cannot find a div with class '"+htmlTagId+"'");return}_controlDiv=control;setTimeout(probemap,500);return}function findStationStyle(id,net,sta,lon,lat,archive,restricted,type,selected){var stname="";if(restricted===1&&type==="p")stname+="rp";else if(restricted===1&&type==="t")stname+="rt";else if(restricted===2&&type==="p"||restricted===3&&type==="p")stname+="op";else if(restricted===2&&type==="t"||restricted===3&&type==="t")stname+="ot";else stname+="uu";if(!selected)stname+="_uns";if(typeof _station_styles[stname]==="undefined"){var style=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);style.externalGraphic=eidaCSSSource+"/"+stname+".png";style.graphicOpacity=0.8;_station_styles[stname]=style}return _station_styles[stname]}function findEventStyle(id,lon,lat,depth,mag,region,date,selected){var stname=undefined;if(mag>6){stname="evbig"}else{stname="evdefault"}if(!selected)stname+="_uns";if(typeof _event_styles[stname]==="undefined"){var style=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]);switch(stname){case"evbig":style.strokeWidth=4;style.strokeDashstyle="solid";style.fillOpacity=0.5;style.fillColor="#ffa000";break;case"evbig_uns":style.strokeWidth=2;style.strokeDashstyle="dashed";style.strokeColor="#c08000";style.fillOpacity=0.2;style.fillColor="#000000";break;case"evdefault":style.strokeWidth=1;style.strokeColor="#ee9900";style.strokeDashstyle="solid";style.fillOpacity=0.4;style.fillColor="#ffa000";break;case"evdefault_uns":style.strokeWidth=1;style.strokeDashstyle="dashed";style.strokeColor="#c08000";style.fillOpacity=0.2;style.fillColor="#000000";break;}_event_styles[stname]=style}return _event_styles[stname]}function createEventFeature(id,lon,lat,depth,mag,region,date,selected){var pt=new OpenLayers.Geometry.Point(Number(lon),Number(lat));pt.transform(_wgs84,_map.getProjection());var ats={name:date,description:"Region: "+region+"<br>Magnitude: "+mag+" Depth: "+depth,evst:"ev",selected:selected,key:id};var style=findEventStyle(id,lon,lat,depth,mag,region,date,selected);return new OpenLayers.Feature.Vector(pt,ats,style)}function createStationFeature(id,net,sta,lon,lat,archive,restricted,type,streams,selected){var pt=new OpenLayers.Geometry.Point(Number(lon),Number(lat));pt.transform(_wgs84,_map.getProjection());var streamtypes={};for(var n in streams){var m=streams[n].match("(.[HLNG]).$");if(m)streamtypes[m[1]]=true}var ats={name:"Network: "+net+" / Station: "+sta,description:"Longitude: "+roundLatLon(Number(lon))+" Latitude: "+roundLatLon(Number(lat))+"<br/>Streams: "+$.map(streamtypes,function(v,k){return k+"*"}).join(", ")+"<br/>Archived at: "+archive,evst:"st",selected:selected,key:id};var style=findStationStyle(id,net,sta,lon,lat,archive,restricted,type,selected);return new OpenLayers.Feature.Vector(pt,ats,style)}function onEventSelect(feature){var button="<div style='text-align: center; padding: 10px 5px 5px 5px;'><input type='button' id='"+feature.attributes.key+"' value='"+(feature.attributes.selected?"Unselect":"Select")+"' onclick='mapControl.toggleItem(this)'></div>";var popup=new OpenLayers.Popup.AnchoredBubble("description",feature.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(250,100),"<div><b>"+feature.attributes.name+"</b><br>"+feature.attributes.description+button+"</div>",null,true,null);feature.popup=popup;_map.addPopup(feature.popup)}function onStationSelect(feature){var button="<div style='text-align: center; padding: 10px 5px 5px 5px;'><input type='button' id='"+feature.attributes.key+"' value='"+(feature.attributes.selected?"Unselect":"Select")+"' onclick=mapControl.toggleItem(this)></div>";var popup=new OpenLayers.Popup.AnchoredBubble("description",feature.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(250,100),"<div><b>"+feature.attributes.name+"</b><br/>"+feature.attributes.description+button+"</div>",null,true,null);feature.popup=popup;_map.addPopup(popup)}function onItemUnselect(item){closePopup(item.feature)}function onItemSelect(item){if(item.feature.attributes.evst==="ev")return onEventSelect(item.feature);if(item.feature.attributes.evst==="st")return onStationSelect(item.feature);throw new WIError("mapping.js: Invalid feature")}function closePopup(feature){_map.removePopup(feature.popup);feature.popup.destroy();delete feature.popup}function removeItem(evst,id){if(!_items)return;if(typeof id==="undefined"){var items=_items.getFeaturesByAttribute("evst",evst);_items.destroyFeatures(items);return}var item=_items.getFeaturesByAttribute("key",id);_items.destroyFeatures(item)}function findFeature(id){var features=_items.getFeaturesByAttribute("key",id);if(features.length!==1)throw new WIError("mapping.js: found more than one feature with id "+id);return features[0]}this.showHelp=function(){var html="";html+="<div>";html+="<h1>Map Control Usage</h1>";html+="<br/>";html+="<p>The mapping control is used to <b>display</b> and <b>further selected stations and events</b>. When you add a set of events or stations to compose your request the selected items will be marked on the map. Use the \"Legend for Icons\" link to see the meaning of the different symbols displayed.</p>";html+="<ul>";html+="<li>To <b>deselect</b> a station or event, click on it and click on the \"Remove\" button. This will disable the chosen item on the list, and it will be removed from the map. To add it again, simply select it again on the list in the \"Event and Station List\" control by checking the corresponding check box item.</li>";html+="<li>You can also use the <b>Shift+Left mouse</b> button to <b>set an area</b> for further restricting the searching of events and stations. (Note that for this region to affect the station search you should make sure to have the Explore Station by Region activated.)</li>";html+="<li>To zoom in once you have selected a region, double-click. To restore the whole-globe view, use the globe control on the top left. You can also use the \"+\" and \"-\" controls there to zoom in and out.</li>";html+="</ul>";html+="<p>The area selected will be automatically inserted into the coordinates area in the Events Control and Station Control. To clear your area selection, use the \"Reset Region\" button on any of those controls.</p>";html+="</div>";$(html).dialog({modal:true,closeOnEscape:true,width:550,height:500,buttons:[{text:"Close help",click:function click(){$(this).dialog("close");$(this).dialog("destroy")}}]})};this.showLegend=function(){var html="";html+="<div style=\"z-index:9999; position: relative;\">";html+="<h1>Legend for Map icons</h1>";html+=legend();html+="</div>";$(html).dialog({modal:false,closeOnEscape:true,width:440,height:330,buttons:[{text:"Close legend",click:function click(){$(this).dialog("close");$(this).dialog("destroy")}}]})};this.toggleItem=function(obj){var id=$(obj).attr("id");var feature=findFeature(id);closePopup(feature);if(feature.attributes.evst==="ev")requestControl.toggleEvent(feature.attributes.key);else if(feature.attributes.evst==="st")requestControl.toggleStation(feature.attributes.key);else throw new WIError("mapping.js: Invalid evst type"+feature.attributes.evst)};this.addEvent=function(id,lon,lat,depth,mag,region,date,selected){if(!_items)return;try{findFeature(id);return}catch(e){var f=createEventFeature(id,lon,lat,depth,mag,region,date,selected);_items.addFeatures([f])}};this.removeEvent=function(id){removeItem("ev",id)};this.addStation=function(id,net,sta,lon,lat,archive,restricted,type,streams,selected){if(!_items)return;try{findFeature(id);return}catch(e){var f=createStationFeature(id,net,sta,lon,lat,archive,restricted,type,streams,selected);_items.addFeatures([f])}};this.removeStation=function(id){removeItem("st",id)};this.setSelect=function(bottom,left,top,right){if(!this.enabled())return;if(bottom<=-90&&top>=90&&left<=-180&&right>=180)return this.clearSelect();_edges.destroyFeatures();var bounds=new OpenLayers.Bounds(left,bottom,right,top);bounds.transform(_wgs84,_map.getProjection());var box=new OpenLayers.Feature.Vector(bounds.toGeometry());_edges.addFeatures([box]);resetZoom(bounds);var cb=getCallbacks("onChangeExtend");for(var key in cb){cb[key](bottom,left,top,right)}};this.clearSelect=function(){_edges.destroyFeatures();resetZoom();var cb=getCallbacks("onChangeExtend");for(var key in cb){cb[key](-90,-180,90,180)}};this.enabled=function(){if(!_controlDiv)return false;if(!_items)return false;return true};this.bind=function(name,method){if(name==="onChangeExtend"){if(typeof _callbacks[name]==="undefined")_callbacks[name]=[];_callbacks[name].push(method);return}throw new WIError("Invalid callback name "+name)};load(htmlTagId)}

},{}],8:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};exports.default=function(){return new Promise(function(resolve,reject){try{window.RequestError=function(message){this.message=message};window.RequestError.prototype=new WIError;window.requestControl=new RequestControl('#wi-RequestManagerControl');resolve()}catch(e){if(console.error!==wiConsole.error)console.error('request.js: '+e.message);wiConsole.error('request.js: '+e.message,e);reject()}})};function Pack(id){var that=this;var arrow;var _station_list=null;var _station_dictionary=null;var _event_list=null;var _event_dictionary=null;var _id=undefined;var _current_event_div=null;var _current_event_count_span=null;var _current_station_div=null;var _current_station_count_span=null;var _locations_index=null;var _orientations_index=null;var _gains_index=null;var _samplings_index=null;function fmtGeneric(rowid,value){return value}function fmtCoordinate(rowid,value){return Number(value).toFixed(2)}function fmtStreams(rowid,value){var groups={};var html='<i>No Streams Selected</i>';if(value.length!==0){for(var key in value){var fcode=value[key].trim();fcode=fcode.substr(0,fcode.length);var bcode=fcode.substr(0,fcode.length-1);if(typeof groups[bcode]==='undefined')groups[bcode]=[];if(groups[bcode].indexOf(fcode)===-1)groups[bcode].push(fcode)}html='<table cellpadding="2" cellspacing="0">';for(var key in groups){html+='<tr><td>'+$.map(groups[key],function(stream){return'<span class="wi-stream-'+stream.replace('.','-')+'">'+stream+'</span>'})+'</td><tr>'}html+='</table>'}return html}function fmtRestricted(rowid,value){if(Number(value)===1){return'<span style="color: red;">R</span>'}else if(Number(value)===2){return'<span style="color: black;">O</span>'}else if(Number(value)===3){return'<span style="color: black;">O/</span><span style="color: red;">R</span>'}else{return'??'}}function fmtId(rowid,value){return'<input class="toggle" title="'+value+'" checked="checked" type="checkbox" value="'+rowid+'"/>'}function fmtCheckbox(rowid,value){var checked=value===true?'checked="checked"':'';return'<input class="toggle" title="'+rowid+'" '+checked+' type="checkbox" value="'+rowid+'"/>'}function fmtDepth(rowid,value){return Number(value).toFixed(1)}function fmtMagnitude(rowid,value){if(value=='--'){return''}else{return Number(value).toFixed(1)};}var _station_format={names:['key','netcode','statcode','latitude','longitude','restricted','netclass','archive','netoperator','streams','streams_restricted','selected','fstreams'],shortnames:['','Network','Station','Lat.','Long.','O/R','Net.Type','Archive','Net.Operator','Streams','StreamsRestricted','selected','Streams'],sortable:[false,true,true,true,true,false,true,true,true,false,false,false,false],format:[fmtId,fmtGeneric,fmtGeneric,fmtCoordinate,fmtCoordinate,fmtRestricted,fmtGeneric,fmtGeneric,fmtGeneric,fmtStreams,fmtGeneric,fmtCheckbox,fmtStreams],aligment:['center','center','center','center','center','center','center','center','center','left','center','center','center'],order:[11,1,2,3,4,5,12]};var _event_format={names:['datetime','magnitude','magtype','latitude','longitude','depth','key','region','selected'],shortnames:['Origin Time','Mag.','Type','Lat.','Long.','Depth','','Region','selected'],sortable:[true,true,false,true,true,true,false,true,false],format:[fmtGeneric,fmtMagnitude,fmtGeneric,fmtCoordinate,fmtCoordinate,fmtDepth,fmtId,fmtGeneric,fmtCheckbox],aligment:['center','center','left','center','center','center','center','left','center'],order:[8,0,1,2,3,4,5,7]};function sortFn(column,reverse){var cindex=column;if(cindex===-1){wiConsole.error('request.js: Cannot find column index for '+column);return null}var flag=reverse?1:-1;var fn=function fn(a,b){if(a[cindex]>b[cindex])return flag*1;if(a[cindex]==b[cindex])return 0;if(a[cindex]<b[cindex])return-1*flag};return fn}function buildChannelFilterIndex(){var locations={};var samplings={};var gains={};var orientations={};if(_station_list){var cid=_station_format.names.indexOf('streams');for(var stkey in _station_list){var stline=_station_list[stkey];for(var chkey in stline[cid]){var channel=stline[cid][chkey];if(channel.indexOf('.')===-1){wiConsole.error('request.js: Invalid location/channel pattern '+channel+'. It does not contains a dot (.)');continue}var channelparts=channel.split('.');if(channelparts.length!==2){wiConsole.error('request.js: Invalid channel/location pattern '+channel+'. It has more than two fields.');continue}if(channelparts[1].length!==3){wiConsole.error('request.js: Invalid channel pattern '+channel.split('.')[1]+'. It should have three letters long corresponding to sampling code, gain code and orientation code. ');continue}var location=channelparts[0];var sampling=channelparts[1][0];var gain=channelparts[1][1];var orientation=channelparts[1][2];if(typeof locations[location]==='undefined')locations[location]=true;if(typeof samplings[sampling]==='undefined')samplings[sampling]=true;if(typeof gains[gain]==='undefined')gains[gain]=true;if(typeof orientations[orientation]==='undefined')orientations[orientation]=true}}}_locations_index=locations;_samplings_index=samplings;_gains_index=gains;_orientations_index=orientations}function sortEventUp(arrow){var column=_event_format.names.indexOf($(arrow.target).parents('th').prop('id'));var _sorted_list=_event_list.sort(sortFn(column,false));_event_list=_sorted_list;that.renderEvent()}function sortEventDown(arrow){var column=_event_format.names.indexOf($(arrow.target).parents('th').prop('id'));var _sorted_list=_event_list.sort(sortFn(column,true));_event_list=_sorted_list;that.renderEvent()}function sortStationUp(arrow){var column=_station_format.names.indexOf($(arrow.target).parents('th').prop('id'));var _sorted_list=_station_list.sort(sortFn(column,false));_station_list=_sorted_list;that.renderStation()}function sortStationDown(arrow){var column=_station_format.names.indexOf($(arrow.target).parents('th').prop('id'));var _sorted_list=_station_list.sort(sortFn(column,true));_station_list=_sorted_list;that.renderStation()}function render_header(format){var html='<tr class="wi-table-header">';var arrows='<span class="wi-arrow-up"></span><span class="wi-arrow-down"></span>';for(var ckey in format.order){var key=format.order[ckey];if(format.names[key]==='selected'){html+='<th class="wi-table-header-cell"><input class="table-toggle" type="checkbox" /></th>';continue}if(format.sortable[key]){html+='<th class="wi-table-header-cell" id="'+format.names[key]+'">'+format.shortnames[key]+arrows+'</th>'}else{html+='<th class="wi-table-header-cell" id="'+format.names[key]+'">'+format.shortnames[key]+'</th>'}}html+='</tr>';return html}function render_row(format,rowkey,data){var html='';var rowid=data[format.names.indexOf('key')];var rowclass=typeof rowclass==='undefined'?'wi-odd':rowclass;rowclass=rowclass==='wi-odd'?'wi-even':'wi-odd';html+='<tr class="'+rowclass+'" id="'+rowid+'">';for(var ckey in format.order){var key=format.order[ckey];html+='<td class="'+format.names[key]+'" valign="top" align="'+format.aligment[key]+'">'+format.format[key](rowid,data[key])+'</td>'}html+='</tr>';return html}function connectEvent(){var skey=_event_format.names.indexOf('selected');_current_event_div.find('table').find('.table-toggle').bind('change',function(item){var obj=$(item.target);obj.parents('table').find('.toggle').prop('checked',obj.is(':checked')).change()});_current_event_div.find('table').find('.toggle').bind('change',function(item){var obj=$(item.target);var evline=_event_dictionary[obj.val()];evline[skey]=obj.is(':checked');if(!obj.is(':checked'))obj.parents('table').find('.table-toggle').prop('checked',false);mapEvent(obj.val())});_current_event_div.find('.wi-arrow-up').bind('click',sortEventUp);_current_event_div.find('.wi-arrow-down').bind('click',sortEventDown)}function connectStation(){var skey=_station_format.names.indexOf('selected');var fkey=_station_format.names.indexOf('fstreams');_current_station_div.find('table').find('.table-toggle').bind('change',function(item){var obj=$(item.target);obj.parents('table').find('.toggle').prop('checked',obj.is(':checked')).change()});_current_station_div.find('table').find('.toggle').bind('change',function(item){var obj=$(item.target);var stline=_station_dictionary[obj.val()];stline[skey]=obj.is(':checked');if(!obj.is(':checked'))obj.parents('table').find('.table-toggle').prop('checked',false);mapStation(obj.val())});_current_station_div.find('.wi-arrow-up').bind('click',sortStationUp);_current_station_div.find('.wi-arrow-down').bind('click',sortStationDown);_current_station_div.find('#station-filter-toggle').button().bind('click',function(obj){_current_station_div.find('#station-filter-toggle').hide();_current_station_div.find('#wi-station-filter-row').show()});_current_station_div.find('#station-filter-close').button().bind('click',function(obj){_current_station_div.find('#station-filter-toggle').show();_current_station_div.find('#wi-station-filter-row').hide()});_current_station_div.find('#station-filter-apply').button().bind('click',function(obj){applyStreamFilter();that.renderStation()});_current_station_div.find('#wi-station-filter-row').hide();for(var key in _locations_index){_current_station_div.find('#location-'+(key===''?'--':key)).change(function(key){return function(){_locations_index[key]=$(this).prop('checked')}}(key))}for(var key in _samplings_index){_current_station_div.find('#sampling-'+key).change(function(key){return function(){_samplings_index[key]=$(this).prop('checked')}}(key))}for(var key in _gains_index){_current_station_div.find('#gain-'+key).change(function(key){return function(){_gains_index[key]=$(this).prop('checked')}}(key))}for(var key in _orientations_index){_current_station_div.find('#orientation-'+key).change(function(key){return function(){_orientations_index[key]=$(this).prop('checked')}}(key))}}function applyStreamFilter(){var stri=_station_format.names.indexOf('streams');var restri=_station_format.names.indexOf('restricted');var fstri=_station_format.names.indexOf('fstreams');var srestri=_station_format.names.indexOf('streams_restricted');var seli=_station_format.names.indexOf('selected');for(var i in _station_list){var streams_filtered=[];var restricted=0;for(var j in _station_list[i][stri]){var stream=_station_list[i][stri][j];var sep=stream.indexOf('.');var loc=stream.substr(0,sep);var samp=stream.substr(sep+1,1);var gain=stream.substr(sep+2,1);var ornt=stream.substr(sep+3,1);if(_locations_index[loc]&&_samplings_index[samp]&&_gains_index[gain]&&_orientations_index[ornt]){streams_filtered.push(stream);restricted=restricted|_station_list[i][srestri][j]}}_station_list[i][fstri]=streams_filtered;if(streams_filtered.length===0)_station_list[i][seli]=false;else _station_list[i][restri]=restricted}}function mapStation(id){if(!mapControl.enabled())return;if(!_station_list)mapControl.removeStation(undefined);var idi=_station_format.names.indexOf('key');var neti=_station_format.names.indexOf('netcode');var stai=_station_format.names.indexOf('statcode');var loni=_station_format.names.indexOf('longitude');var lati=_station_format.names.indexOf('latitude');var arci=_station_format.names.indexOf('archive');var resi=_station_format.names.indexOf('restricted');var typi=_station_format.names.indexOf('netclass');var stri=_station_format.names.indexOf('streams');var selected=_station_format.names.indexOf('selected');for(var key in _station_list){var line=_station_list[key];if(typeof id!=='undefined'&&line[idi]!==id)continue;mapControl.removeStation(line[idi]);mapControl.addStation(line[idi],line[neti],line[stai],line[loni],line[lati],line[arci],line[resi],line[typi],line[stri],line[selected])}}function mapEvent(id){if(!mapControl.enabled())return;if(!_event_list)mapControl.removeEvent(undefined);var idi=_event_format.names.indexOf('key');var lati=_event_format.names.indexOf('latitude');var loni=_event_format.names.indexOf('longitude');var depi=_event_format.names.indexOf('depth');var regi=_event_format.names.indexOf('region');var dati=_event_format.names.indexOf('datetime');var magi=_event_format.names.indexOf('magnitude');var selected=_event_format.names.indexOf('selected');for(var key in _event_list){var line=_event_list[key];if(typeof id!=='undefined'&&line[idi]!==id)continue;mapControl.removeEvent(line[idi]);mapControl.addEvent(line[idi],line[loni],line[lati],line[depi],line[magi],line[regi],line[dati],line[selected])}}function renderStationFilter(fieldname,table){var html='';var keys=Object.keys(table).sort();for(var keyid in keys){var key=keys[keyid];var checked=table[key]?'checked="checked"':'';if(key==='')key='--';html+='<div id="wi-'+fieldname+'-filter-group" style="float: left; margin: 2px 2px 0 0;">';html+='<input type="checkbox" id="'+fieldname+'-'+key+'" value="'+key+'" '+checked+'/><label for="'+fieldname+'-'+key+'">'+key+'</label>';html+='</div>'}return html}function renderStationFilters(format){var html='';html+='<tr><td style="font-size: 0.8em; text-align: right; padding: 5px; 35px 5px 0;" colspan="'+format.order.length+'"><input id="station-filter-toggle" type="button" value="Filters"/></td></tr>';html+='<tr id="wi-station-filter-row"><td class="wi-station-filter" colspan="'+format.order.length+'">';html+='<div style="width: 135px; margin: 0 2px 0 0; float: left;">';html+='<h3>Location Code</h3>';html+=renderStationFilter('location',_locations_index);html+='</div>';html+='<div style="width: 135px; margin: 0 2px 0 0; float: left;">';html+='<h3>Sampling Code</h3>';html+=renderStationFilter('sampling',_samplings_index);html+='</div>';html+='<div style="width: 135px; margin: 0 2px 0 0; float: left;">';html+='<h3>Instrument Code</h3>';html+=renderStationFilter('gain',_gains_index);html+='</div>';html+='<div style="width: 135px; margin: 0 2px 0 0; float: left;">';html+='<h3>Orientation Code</h3>';html+=renderStationFilter('orientation',_orientations_index);html+='</div>';html+='<div style="text-align: right; float: right; font-size: 0.8em;">';html+='<input style="margin: 5px 0 0 0" id="station-filter-close" type="button" value="Close"/><br/>';html+='<input style="margin: 5px 0 0 0" id="station-filter-apply" type="button" value="Filter"/>';html+='</div>';html+='</td></tr>';return html}this.toggleEvent=function(id){if(!_event_list)return;var checkbox=_current_event_div.find('table').find('.toggle[value='+id+']');checkbox.prop('checked',!checkbox.prop('checked')).change()};this.toggleStation=function(id){if(!_station_list)return;var checkbox=_current_station_div.find('table').find('.toggle[value='+id+']');checkbox.prop('checked',!checkbox.prop('checked')).change()};this.saveStation=function(){wiConsole.info('Building the list of selected streams...');var streams=Array();var neti=_station_format.names.indexOf('netcode');var stai=_station_format.names.indexOf('statcode');var fstreamsi=_station_format.names.indexOf('fstreams');var seli=_station_format.names.indexOf('selected');var t;for(var k in _station_list){if(_station_list[k][seli]===false){continue}var loccha=_station_list[k][fstreamsi];if(typeof loccha!=='undefined'&&loccha.length>0){var loc_list=Array();var cha_list=Array();var words;for(var i=0;i<loccha.length;i++){words=loccha[i].split('.');loc_list.push(words[0]);cha_list.push(words[1])}for(var i=0;i<loc_list.length;i++){var t=Array(_station_list[k][neti],_station_list[k][stai],cha_list[i],loc_list[i]);streams.push(t)}}}var streams_json=JSON.stringify(streams);$('form[name="exportForm"]').find('input[name="streams"]')[0].value=streams_json;$('form[name="exportForm"]').submit();wiConsole.info(' ...exported stream(s)')};this.reduceEventsRows=function(rowkeys){var remove_checked=true;var retain_checked=!remove_checked;var data=_event_list;if(data){alert('Data length:'+data.length)}else{alert('Data is null')}var count=0;var count_checked=0;var new_data=Array();for(var key in data){var row=data[key];count+=1;var checked=row[7];if(retain_checked&&checked||remove_checked&&!checked){count_checked+=1;new_data.push(row);console.log('Added '+row);alert('Added '+count+':'+row)}}_event_list=new_data;alert('Checked: '+count_checked+'/'+count);console.log('New length: '+new_data.length);return};this.addEvent=function(data){if(_event_list===null){_event_list=[];_event_dictionary={}}var eidkey=_event_format.names.indexOf('key');var datacopy=Array();$.extend(true,datacopy,$.grep(data,function(evline){return!(evline[eidkey]in _event_dictionary)}));var header=datacopy.shift();for(var key in header){if(header[key]!==_event_format.names[key])console.error('request.js: Event header '+header[key]+' format does not match current implementation.')}for(var key in datacopy){var evline=datacopy[key];evline.push(true);if(evline.length!==_event_format.names.length){throw new RequestError('Shut down!')}for(var key2 in evline){if(_typeof(evline[key2])==='object')throw new RequestError('Shut down! -- '+_event_format.names[key2]+' it is a object')}if(typeof _event_dictionary[evline[eidkey]]!=='undefined'){throw new RequestError('request.js: OOOPS -- Duplicated ID in event list.')}_event_dictionary[evline[eidkey]]=evline}_event_list=_event_list.concat(datacopy);return true};this.addStation=function(data){if(_station_list===null){_station_list=[];_station_dictionary={}}var datacopy=Array();$.extend(true,datacopy,data);var header=datacopy.shift();for(var key in header){if(header[key]!==_station_format.names[key])wiConsole.error('request.js: Station header '+header[key]+' format does not match current implementation.')}var eidkey=_station_format.names.indexOf('key');var duplicates=Array();for(var key in datacopy){var stline=datacopy[key];stline.push(true);if(typeof _station_dictionary[stline[eidkey]]!=='undefined'){wiConsole.error('request.js: Ignoring duplicate station item ID'+stline[eidkey]);duplicates.push(key)}}duplicates.reverse();for(var key in duplicates){datacopy.splice(duplicates[key],1)}_station_list=_station_list.concat(datacopy);_station_dictionary={};for(var key in _station_list){var stline=_station_list[key];_station_dictionary[stline[eidkey]]=stline}buildChannelFilterIndex();applyStreamFilter();return true};this.hasStation=function(){return _station_list!==null};this.hasEvent=function(){return _event_list!==null};this.eventsCount=function(){return this.hasEvent()?_event_list.length:'-'};this.eventsSelectedCount=function(){var n=0;for(var key in _event_list){var checked=_event_list[key][7];if(checked){n+=1}}return n};this.stationsCount=function(){return this.hasStation()?_station_list.length:'-'};this.id=function(){return _id};this.eventLines=function(){var lines=Array();var latitude=_event_format.names.indexOf('latitude');var longitude=_event_format.names.indexOf('longitude');var depth=_event_format.names.indexOf('depth');var time=_event_format.names.indexOf('datetime');var selected=_event_format.names.indexOf('selected');for(var key in _event_list){var line=_event_list[key];if(line[selected]===false)continue;lines.push([Number(line[latitude]),Number(line[longitude]),Number(line[depth]),new Date(line[time]+'Z').toISOString()])}return lines};this.stationLines=function(){var lines=Array();var networkKey=_station_format.names.indexOf('netcode');var stationKey=_station_format.names.indexOf('statcode');var streamKey=_station_format.names.indexOf('fstreams');var selected=_station_format.names.indexOf('selected');for(var rowindex in _station_list){var line=_station_list[rowindex];if(line[selected]===false)continue;var items=Array();for(var key in line[streamKey]){if(items.indexOf(line[streamKey][key])===-1)items.push(line[streamKey][key])}for(var key in items){var location=items[key].split('.')[0];var stream=items[key].split('.')[1];lines.push([line[networkKey],line[stationKey],stream,location])}}return lines};this.renderStation=function(div,countspan){if(_current_station_div===null&&div===null)throw new RequestError('request.js: Unknown div for rendering station.');var html='<i> No Stations loaded </i>';if(_current_station_div)_current_station_div.empty();if(div)_current_station_div=div;if(countspan)_current_station_count_span=countspan;if(_station_list){html='<table cellpadding="0" cellspacing="0" width="100%">';html+=render_header(_station_format);html+=renderStationFilters(_station_format);for(var key in _station_list){html+=render_row(_station_format,key,_station_list[key])}html+='</table>'}_current_station_div.append(html);var text=this.stationsCount()+(this.hasStation()?this.stationsCount()===1?' station':' stations':'');_current_station_count_span.text(text);connectStation();mapStation()};this.renderEvent=function(div,countspan){if(_current_event_div===null&&div===null)throw new RequestError('request.js: Unknown div for rendering event.');var html='<i> No Events loaded </i>';if(_current_event_div)_current_event_div.empty();if(div)_current_event_div=div;if(countspan)_current_event_count_span=countspan;if(_event_list){html='<table cellpadding="0" cellspacing="0" width="100%">';html+=render_header(_event_format);for(var key in _event_list){html+=render_row(_event_format,key,_event_list[key])}html+='</table>'}_current_event_div.append(html);var text=this.eventsCount()+(this.hasEvent()?this.eventsCount()===1?' event':' events':'');_current_event_count_span.text(text);connectEvent();mapEvent()};this.removeStation=function(){_station_list=null;this.renderStation(null,null)};this.removeEvent=function(){_event_list=null;this.renderEvent(null,null)};this.freeze=function(div){var id=div.attr('id');if(this.hasEvent()){var seli=_event_format.names.indexOf('selected');var _event_list_frozen=[];for(var key in _event_list){var line=_event_list[key];if(line[seli])_event_list_frozen.push(line)}_event_list=_event_list_frozen;this.renderEvent(div.find('#'+id+'-events-div'),div.find('#'+id+'-events-count'))}if(this.hasStation()){var seli=_station_format.names.indexOf('selected');var _station_list_frozen=[];for(var key in _station_list){var line=_station_list[key];if(line[seli])_station_list_frozen.push(line)}_station_list=_station_list_frozen;this.renderStation(div.find('#'+id+'-stations-div'),div.find('#'+id+'-stations-count'))}};if(id===undefined||id===null)throw new RequestError('Invalid supplied id.');_id=id};function RequestControl(htmlTagId){var _controlDiv=null;var _data=undefined;var _callbacks={};function buildControl(){if(!_controlDiv)return;var html='';html+='<div id="requestControlControls"></div>';html+='<div id="requestControlTables"></div>';_controlDiv.append(html)}function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error('request.js: Cannot find a div with class \''+htmlTagId+'\'.');return}_controlDiv=control;buildControl()}function generate_id(){var timestamp=new Date().getTime();return timestamp}function newPackage(){var package_id=generate_id();_data=new Pack(package_id);return getPackage()}function getPackage(){if(typeof _data==='undefined'){throw new RequestError('request.js: No Request to return.')}return _data}function remove(id){try{var datapack=getPackage();datapack.removeEvent();datapack.removeStation();_data=undefined;_controlDiv.find('#'+id).remove()}catch(e){wiConsole.error('No request to remove.')}}function connect(id){_controlDiv.find('#'+id+'-delete-events').button().bind('click',function(item){var id=$(item.target).parent('div').attr('id');var pkg=null;try{pkg=getPackage()}catch(e){return}if(!pkg.hasEvent()){alert('Request has no events currently associated.');return}pkg.removeEvent();if(pkg.hasStation()===false&&pkg.hasEvent()===false){remove(id)}var cb=getCallbacks('onDeleteEvents');for(var key in cb){cb[key]()}});_controlDiv.find('#'+id+'-delete-stations').button().bind('click',function(item){var id=$(item.target).parent('div').attr('id');var pkg=null;try{pkg=getPackage()}catch(e){return}if(!pkg.hasStation()){alert('Request has no stations currently associated.');return}pkg.removeStation();if(pkg.hasStation()===false&&pkg.hasEvent()===false){remove(id)}var cb=getCallbacks('onDeleteStations');for(var key in cb){cb[key]()}});_controlDiv.find('#'+id+'-save-stations').button().bind('click',function(item){var id=$(item.target).parent('div').attr('id');var pkg=null;try{pkg=getPackage()}catch(e){return}if(!pkg.hasStation()){alert('Request has no stations currently associated.');return}pkg.saveStation()});_controlDiv.find('#'+id+'-freeze').button().bind('click',function(item){var id=$(item.target).parent('div').attr('id');var pkg=null;try{pkg=getPackage()}catch(e){return}pkg.freeze($(item.target).parent('div'))})}function render(){var id='theone';var html='';var size=150;var datapack=undefined;try{datapack=getPackage()}catch(e){wiConsole.error('request.js: No request loaded to render.')}if(_controlDiv.find('#'+id).length===0){var exportURL=configurationProxy.serviceRoot()+'metadata/export';html+='<div class="wi-request-pack-div" id="'+id+'">';html+='<input style="float: right;" id="'+id+'-delete-events" type="button" value="Delete Events" />';html+='<input style="float: right;" id="'+id+'-save-stations" type="button" value="Save Stations" />';html+='<input style="float: right;" id="'+id+'-delete-stations" type="button" value="Delete Stations" />';html+='<input style="float: right;" id="'+id+'-freeze" type="button" value="Freeze" />';html+='<form id="exportForm" name="exportForm" action="'+exportURL+'" target="exportIframe" method="post" enctype="multipart/form-data">';html+='<input type="text" name="streams" value="" style="display: none;" />';html+='</form>';html+='<iframe name="exportIframe" src="#" style="display: none;" ></iframe>';html+='<div style="float: left;"><h2>Request: </h2></div>';html+='<br class="wi-clear"/>';html+='<div style="padding-left: 10px;">';html+='<h3>Events (<span id="'+id+'-events-count"></span>)</h3>';html+='<div id="'+id+'-events-div" style="width: 100%; max-height: 180px; overflow: auto; margin: 0 0 10px 0;"></div>';html+='<h3>Stations (<span id="'+id+'-stations-count"></span>)</h3>';html+='<div id="'+id+'-stations-div" style="width: 100%; max-height: 270px; overflow: auto; margin: 0 0 10px 0;"></div>';html+='</div>';html+='</div>';_controlDiv.find('#requestControlTables').append(html);connect(id)}datapack.renderEvent(_controlDiv.find('#'+id+'-events-div'),_controlDiv.find('#'+id+'-events-count'));datapack.renderStation(_controlDiv.find('#'+id+'-stations-div'),_controlDiv.find('#'+id+'-stations-count'))}function _presets(param){switch(param.requesttype){case'FDSNWS-dataselect':return{service:'dataselect',options:{},bulk:false,merge:true,contentType:'application/vnd.fdsn.mseed',filename:param.description.replace(' ','_')+'.mseed'};case'FDSNWS-station-xml':return{service:'station',options:{format:'xml',level:param.level},bulk:true,merge:false,contentType:'application/xml',filename:param.description.replace(' ','_')+'.xml'};case'FDSNWS-station-text':return{service:'station',options:{format:'text',level:param.level},bulk:true,merge:true,contentType:'text/plain',filename:param.description.replace(' ','_')+'.txt'};default:return{};}}function _submit(info){wiConsole.info('Fetching the list of time windows...');wiService.metadata.timewindows(function(tw){wiConsole.info('...done');if(tw.length>0){info.request.timewindows=JSON.stringify(tw);if(info.review){wiRequestReviewControl.review(info.request,function(){wiFDSNWS_Control.submitRequest($.extend(info.request,_presets(info.request)));return true},function(){return confirm('Discard request?')})}else{wiFDSNWS_Control.submitRequest($.extend(info.request,_presets(info.request)))}}else{wiConsole.warning('None of the requested streams were available in the given time period.')}},function(jqxhr){if(jqxhr.status==500)var err=jqxhr.statusText;else var err=jqxhr.responseText;if(err=='maximum request size exceeded'){var totalLineLimit=configurationProxy.value('request.totalLineLimit',10000);alert('Limit of '+totalLineLimit+' traces exceeded.\n\nPlease deselect some stations, streams and/or events.');return}wiConsole.error('Failed to get timewindows: '+err)},true,info.timewindow)}this.appendEvent=function(event_data){var node=null;try{node=getPackage()}catch(e){node=newPackage()}if(!node)throw new RequestError('request.js: Cannot create a new request.');node.addEvent(event_data);render();var cb=getCallbacks('onAddEvents');for(var key in cb){cb[key]()}};this.appendStation=function(station_data){var node=null;try{node=getPackage()}catch(e){node=newPackage()}if(!node)throw new RequestError('request.js: Cannot create a new request.');node.addStation(station_data);render();var cb=getCallbacks('onAddStations');for(var key in cb){cb[key]()}};this.hasEvent=function(){return getPackage().hasEvent()};this.hasStation=function(){return getPackage().hasStation()};this.eventLines=function(){return getPackage().eventLines()};this.stationLines=function(){return getPackage().stationLines()};this.toggleEvent=function(id){return getPackage().toggleEvent(id)};this.toggleStation=function(id){return getPackage().toggleStation(id)};this.submit=function(submit_info){var pkg=getPackage();if(!pkg.hasStation()){alert('Cannot submit Request: it has no station list associated.\n\nPlease associate one station list to this package.');return}if(submit_info.mode==='Relative'&&!pkg.hasEvent()){alert('Cannot submit Request: it has no events associated.\n\nYou cannot use relative time windows with requests without events associated. Please associate one event list to this request.');return}var info={};$.extend(true,info,submit_info);info.timewindow.streams=JSON.stringify(pkg.stationLines());if(submit_info.mode==='Relative'){info.timewindow.events=JSON.stringify(pkg.eventLines())}info.request.description='Package '+pkg.id();_submit(info)};load(htmlTagId);this.bind=function(name,method){var valid=['onAddEvents','onAddStations','onDeleteEvents','onDeleteStations','onSaveStations'];if(valid.indexOf(name)===-1){throw new WIError('Invalid callback name '+name)}if(typeof _callbacks[name]==='undefined')_callbacks[name]=[];_callbacks[name].push(method)};function getCallbacks(name){if(typeof _callbacks[name]==='undefined')return[];return _callbacks[name]}};

},{}],9:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{window.wiRequestReviewControl=new WIRequestReviewControl('#wi-RequestReviewControl');resolve()}catch(e){if(console.error!==wiConsole.error)console.error('review.js: '+e.message);wiConsole.error('review.js: '+e.message,e);reject()}})};function WIRequestReviewControl(htmlTagId){var _popupDiv=null;var _displayDiv=null;var _doneButton=null;var _cancelButton=null;function buildControl(){_popupDiv=$('<div class="wi-review-popup"/>');_popupDiv.dialog({autoOpen:false,modal:true,width:900});_displayDiv=$('<div class="wi-review-display"/>');var buttonsDiv=$('<div class="wi-control-item-last"/>');_cancelButton=$('<input class="wi-inline" type="button" value="Cancel"/>');_cancelButton.button();_doneButton=$('<input class="wi-inline" type="button" value="Submit"/>');_doneButton.button();buttonsDiv.append(_cancelButton);buttonsDiv.append(_doneButton);_popupDiv.append(_displayDiv);_popupDiv.append(buttonsDiv)}function load(htmlTagId){buildControl()}function steepen(timewindows){var twtree={net:{},netlist:[]};$.each(timewindows,function(i,twitem){if(twitem[2]in twtree.net){var net=twtree.net[twitem[2]]}else{var net={sta:{},stalist:[]};twtree.net[twitem[2]]=net}if(twitem[3]in net.sta){var sta=net.sta[twitem[3]]}else{var sta={tw:{},twlist:[],str:{},strlist:[],ch:{},size:{}};net.sta[twitem[3]]=sta}sta.tw[twitem[0]+twitem[1]]={enabled:true,start:twitem[0],end:twitem[1]};sta.ch[twitem[5]+twitem[4]]={enabled:true,cha_code:twitem[4],loc_code:twitem[5]};sta.size[twitem[0]+twitem[1]+twitem[5]+twitem[4]]=twitem[6]});$.each(twtree.net,function(net_code,net){twtree.netlist.push(net_code);$.each(net.sta,function(sta_code,sta){net.stalist.push(sta_code);$.each(sta.tw,function(k,v){sta.twlist.push(k)});sta.twlist.sort();$.each(sta.ch,function(k,v){var sk=v.loc_code+v.cha_code.substr(0,2);if(sk in sta.str)sta.str[sk].push(v.loc_code+v.cha_code);else sta.str[sk]=[v.loc_code+v.cha_code]});$.each(sta.str,function(k,v){sta.strlist.push(k);v.sort()});sta.strlist.sort()});net.stalist.sort()});twtree.netlist.sort();return twtree}function flatten(twtree){var timewindows=[];$.each(twtree.netlist,function(i,net_code){var net=twtree.net[net_code];$.each(net.stalist,function(i,sta_code){var sta=net.sta[sta_code];$.each(sta.twlist,function(i,tk){var tw=sta.tw[tk];if(!tw.enabled)return true;$.each(sta.strlist,function(i,sk){var chlist=sta.str[sk];$.each(chlist,function(i,ck){var ch=sta.ch[ck];if(!ch.enabled)return true;if(!(tk+ck in sta.size))return true;timewindows.push([tw.start,tw.end,net_code,sta_code,ch.cha_code,ch.loc_code,sta.size[tk+ck]])})})})})});return timewindows}function toggleNetwork(){var tr=$(this).parent().parent();tr.find('input[name=station]').prop('checked',$(this).prop('checked')).change();tr.nextUntil('.wi-net-row').find('input[name=station]').prop('checked',$(this).prop('checked')).change()}function toggleStation(){var tr=$(this).parent().parent();tr.find('input[name=twsel]').prop('checked',$(this).prop('checked')).change()}function toggleTW(){var div=$(this).parent();var tw=div.data('tw');var td=div.parent();var tr=td.parent();var chdisable=true;tw.enabled=$(this).prop('checked');td.find('input[name=twsel]').each(function(i,e){if($(e).prop('checked')){chdisable=false;return false}});tr.find('input[name=chsel]').prop('disabled',chdisable)}function changeTWStart(){var div=$(this).parent();var tw=div.data('tw');tw.start=$(this).val()}function changeTWEnd(){var div=$(this).parent();var tw=div.data('tw');tw.end=$(this).val()}function toggleChannel(){var ch=$(this).data('ch');ch.enabled=$(this).prop('checked')}function review(param,done,cancel){var self=this;var twtree=steepen(JSON.parse(param.timewindows));var haveStream={};var html='';html+='<table style="width: 100%">';html+='<tr class="wi-odd">';html+='<th>Network</th>';html+='<th>Station</th>';html+='<th>Time Windows</th>';html+='<th>Stream Selection';html+='<table>';html+='<tr>';html+='<td rowspan="2"><select name="selstream" size="3" multiple="multiple"/></td>';html+='<td style="text-align: left">';html+='<div>';html+='<input type="button" value="All" name="allvert"/>';html+='<input type="button" value="None" name="novert"/> Vertical';html+='</div>';html+='</td>';html+='</tr>';html+='<tr>';html+='<td style="text-align: left">';html+='<div>';html+='<input type="button" value="All" name="allhor"/>';html+='<input type="button" value="None" name="nohor"/> Horizontal';html+='</div>';html+='</td>';html+='</tr>';html+='</table>';html+='</th>';html+='</tr>';html+='</table>';var reviewTable=$(html);reviewTable.find('input[name=allvert]').click(function(){reviewTable.find('input.wi-comp-vert').prop('checked',true).change()});reviewTable.find('input[name=novert]').click(function(){reviewTable.find('input.wi-comp-vert').prop('checked',false).change()});reviewTable.find('input[name=allhor]').click(function(){reviewTable.find('input.wi-comp-horiz').prop('checked',true).change()});reviewTable.find('input[name=nohor]').click(function(){reviewTable.find('input.wi-comp-horiz').prop('checked',false).change()});var nrow='wi-odd';var srow='wi-odd';$.each(twtree.netlist,function(i,net_code){var net=twtree.net[net_code];$.each(net.stalist,function(i,sta_code){var sta=net.sta[sta_code];var tr,td;if(i==0){srow=nrow=nrow=='wi-even'?'wi-odd':'wi-even';tr=$('<tr class="wi-net-row '+nrow+'"/>');td=$('<td rowspan="'+net.stalist.length+'"/>');var networkCheckbox=$('<input type="checkbox" name="network" checked="checked"/>');networkCheckbox.change(toggleNetwork);td.append(networkCheckbox);td.append(document.createTextNode(net_code));tr.append(td)}else{srow=srow=='wi-even'?'wi-odd':'wi-even';tr=$('<tr class="'+srow+'"/>')}td=$('<td nowrap="nowrap"/>');var stationCheckbox=$('<input type="checkbox" name="station" checked="checked"/>');stationCheckbox.change(toggleStation);td.append(stationCheckbox);td.append(document.createTextNode(sta_code));tr.append(td);td=$('<td nowrap="nowrap">');$.each(sta.twlist,function(i,tk){var tw=sta.tw[tk];var div=$('<div>');div.data('tw',tw);var twCheckbox=$('<input type="checkbox" name="twsel" checked="checked"/>');twCheckbox.change(toggleTW);var twStart=$('<input type="text" name="twstart" value="'+tw.start+'" size="22"/>');twStart.change(changeTWStart);var twEnd=$('<input type="text" name="twend" value="'+tw.end+'" size="22"/>');twEnd.change(changeTWEnd);div.append(twCheckbox);div.append(twStart);div.append('<span class="wi-to">-</span>');div.append(twEnd);td.append(div)});tr.append(td);td=$('<td>');var chTable=$('<table>');$.each(sta.strlist,function(i,sk){var chlist=sta.str[sk];var chTr=$('<tr>');$.each(chlist,function(i,ck){var ch=sta.ch[ck];var str_code=ch.cha_code.substr(0,2);var comp='horiz';if(ch.cha_code.substr(2,1)=='Z')comp='vert';haveStream[str_code]=true;var chTd=$('<td>');var chCheckbox=$('<input class="wi-stream-'+str_code+' wi-comp-'+comp+'" type="checkbox" name="chsel" checked="checked"/>');chCheckbox.data('ch',ch);chCheckbox.change(toggleChannel);chTd.append(chCheckbox);chTd.append(document.createTextNode(ck));chTr.append(chTd)});chTable.append(chTr)});td.append(chTable);tr.append(td);reviewTable.append(tr)})});var existingStreams=[];$.each(haveStream,function(k,v){existingStreams.push(k)});existingStreams.sort();var selstream=reviewTable.find('select[name=selstream]');$.each(existingStreams,function(i,str_code){selstream.append('<option selected="selected" value="'+str_code+'">'+str_code+'</option>')});selstream.change(function(item){if($(this).val()){var selected={};$.each($(this).val(),function(i,s){selected[s]=true});$.each(existingStreams,function(i,s){reviewTable.find('input.wi-stream-'+s).prop('checked',s in selected).change()})}else{reviewTable.find('input[name=chsel]').prop('checked',false)}});var closeRequested=false;_doneButton.click(function(){param.timewindows=JSON.stringify(flatten(twtree));if(done()){closeRequested=true;_popupDiv.dialog('close')}});_cancelButton.click(function(){if(cancel()){closeRequested=true;_popupDiv.dialog('close')}});_popupDiv.on('dialogbeforeclose',function(){if(closeRequested||cancel()){_doneButton.unbind('click');_cancelButton.unbind('click');_popupDiv.off('dialogbeforeclose');_displayDiv.empty();return true}return false});_displayDiv.append(reviewTable);_popupDiv.dialog('option','title','Review of '+param.description);_popupDiv.dialog('open')}this.review=review;load(htmlTagId)}

},{}],10:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _typeof=typeof Symbol==='function'&&typeof Symbol.iterator==='symbol'?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==='function'&&obj.constructor===Symbol&&obj!==Symbol.prototype?'symbol':typeof obj};exports.default=function(){return new Promise(function(resolve,reject){try{window.wiService=new WIService;resolve()}catch(e){if(console.error!==wiConsole.error)console.error('service.js: '+e.message);wiConsole.error('service.js: '+e.message,e);reject()}})};function WIService(){var _busyCount=0;function increaseBusyCount(){if(++_busyCount==1)$(document.body).addClass('busy')}function decreaseBusyCount(){if(--_busyCount==0)$(document.body).removeClass('busy')}function doneFn(func,bc,fail){return function(rawdata,statustext,jqxhr){try{var data=rawdata!==undefined?$.parseJSON(rawdata):undefined}catch(e){var jqxhr={status:0,statusText:'JSON Parse Error',responseText:e.message};fail(jqxhr,statustext,e);return}if(bc)decreaseBusyCount();if(func){try{func(data,statustext,jqxhr)}catch(e){wiConsole.error(e.message,e)}}}}function failFn(func,bc,msg){return function(jqxhr,statustext,exc){if(bc)decreaseBusyCount();if(func){try{func(jqxhr,statustext,exc)}catch(e){wiConsole.error(e.message,e)}}else{var err;if(jqxhr.status==500)err=jqxhr.statusText;else err=jqxhr.responseText;wiConsole.error(msg+': '+err)}}}function get(done,fail,bc,url,failMsg,param1,param){if(bc)increaseBusyCount();if((typeof param1==='undefined'?'undefined':_typeof(param1))=='object')param=param1;for(var p in param){if(param[p]===undefined)delete param[p]}param._=$.now();var f=failFn(fail,bc,failMsg);return $.get(url,param,doneFn(done,bc,f)).fail(f)}function post(done,fail,bc,url,failMsg,param1,param){if(bc)increaseBusyCount();if((typeof param1==='undefined'?'undefined':_typeof(param1))=='object')param=param1;for(var p in param){if(param[p]===undefined)delete param[p]}var f=failFn(fail,bc,failMsg);return $.post(url,param,doneFn(done,bc,f)).fail(f)}this.configuration=function(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'configuration';var failMsg='Failed to get configuration';return get(done,fail,bc,url,failMsg,param1,param)};this.loader=function(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'loader';var failMsg='Failed to get loader';return get(done,fail,bc,url,failMsg,param1,param)};this.metadata={sensortypes:function sensortypes(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'metadata/sensortypes';var failMsg='Failed to get sensor type list';return get(done,fail,bc,url,failMsg,param1,param)},networktypes:function networktypes(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'metadata/networktypes';var failMsg='Failed to get networks types list';return get(done,fail,bc,url,failMsg,param1,param)},phases:function phases(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'metadata/phases';var failMsg='Failed to get supported phase list';return get(done,fail,bc,url,failMsg,param1,param)},networks:function networks(done,fail,bc,start,end,networktype){var param={start:start,end:end,networktype:networktype};var url=configurationProxy.serviceRoot()+'metadata/networks';var failMsg='Failed to get networks';return get(done,fail,bc,url,failMsg,start,param)},stations:function stations(done,fail,bc,start,end,networktype,network){var param={start:start,end:end,networktype:networktype,network:network};var url=configurationProxy.serviceRoot()+'metadata/stations';var failMsg='Failed to get stations';return get(done,fail,bc,url,failMsg,start,param)},streams:function streams(done,fail,bc,start,end,networktype,network,station){var param={start:start,end:end,networktype:networktype,network:network,station:station};var url=configurationProxy.serviceRoot()+'metadata/streams';var failMsg='Failed to get streams';return post(done,fail,bc,url,failMsg,start,param)},query:function query(done,fail,bc,start,end,network,networktype,station,sensortype,preferredsps,streams,minlat,maxlat,minlon,maxlon,minradius,maxradius,minazimuth,maxazimuth,events){var param={start:start,end:end,network:network,networktype:networktype,station:station,sensortype:sensortype,preferredsps:preferredsps,streams:streams,minlat:minlat,maxlat:maxlat,minlon:minlon,maxlon:maxlon,minradius:minradius,maxradius:maxradius,minazimuth:minazimuth,maxazimuth:maxazimuth,events:events};var url=configurationProxy.serviceRoot()+'metadata/query';var failMsg='Metadata query failed';return post(done,fail,bc,url,failMsg,start,param)},timewindows:function timewindows(done,fail,bc,streams,start,end,events,startphase,startoffset,endphase,endoffset){var param={streams:streams,start:start,end:end,events:events,startphase:startphase,startoffset:startoffset,endphase:endphase,endoffset:endoffset};var url=configurationProxy.serviceRoot()+'metadata/timewindows';var failMsg='Failed to get time windows';return post(done,fail,bc,url,failMsg,streams,param)},export:function _export(done,fail,bc,streams){var param={streams:streams};bc=false;var url=configurationProxy.serviceRoot()+'metadata/export';var failMsg='Oops, couldn\'t save streams list';return post(done,fail,bc,url,failMsg,streams,param)}};this.event={catalogs:function catalogs(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'event/catalogs';var failMsg='Failed to get event catalogs';return get(done,fail,bc,url,failMsg,param1,param)},parse:function parse(done,fail,bc,format,columns,input){var param={informat:format,columns:columns,input:input};var url=configurationProxy.serviceRoot()+'event/parse';var failMsg='Failed to post event parser service';var br=';';failMsg+=br;failMsg+=' informat: '+format+br;failMsg+=' columns: '+columns+br;failMsg+=' input: \''+input+'\''+br;return post(done,fail,bc,url,failMsg,format,param)},query:function query(done,fail,bc,catalog,start,end,minmag,maxmag,mindepth,maxdepth,minlat,maxlat,minlon,maxlon){var param={start:start,end:end,minmag:minmag,maxmag:maxmag,mindepth:mindepth,maxdepth:maxdepth,minlat:minlat,maxlat:maxlat,minlon:minlon,maxlon:maxlon};var failMsg='Failed to get events';var srvName=undefined;if((typeof catalog==='undefined'?'undefined':_typeof(catalog))==='object'){if(typeof catalog['catalog']==='undefined'){var jqxhr={status:400,statusText:'Bad Request',responseText:'invalid catalog service'};failFn(fail,false,failMsg)(jqxhr);return}srvName=catalog.catalog;delete catalog.catalog}else{srvName=catalog}var url=configurationProxy.serviceRoot()+'event/'+srvName;return get(done,fail,bc,url,failMsg,catalog,param)}};this.request={types:function types(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'request/types';var failMsg='Failed to get request types';return get(done,fail,bc,url,failMsg,param1,param)},nodes:function nodes(done,fail,bc,param1){var param={};var url=configurationProxy.serviceRoot()+'request/nodes';var failMsg='Failed to get node list';return get(done,fail,bc,url,failMsg,param1,param)},status:function status(done,fail,bc,server,user,request,start,count){var param={server:server,user:user,request:request,start:start,count:count};var url=configurationProxy.serviceRoot()+'request/status';var failMsg='Failed to load status from '+server;return get(done,fail,bc,url,failMsg,server,param)},purge:function purge(done,fail,bc,server,user,request){var param={server:server,user:user,request:request};var url=configurationProxy.serviceRoot()+'request/purge';var failMsg='Failed to purge request '+request+' at '+server;return get(done,fail,bc,url,failMsg,server,param)},submit:function submit(done,fail,bc,user,requesttype,compressed,responsedictionary,timewindows,eventinfo){var param={user:user,requesttype:requesttype,compressed:compressed,responsedictionary:responsedictionary,timewindows:timewindows,eventinfo:eventinfo};var url=configurationProxy.serviceRoot()+'request/submit';var failMsg='Failed to submit request';return post(done,fail,bc,url,failMsg,user,param)},resubmit:function resubmit(done,fail,bc,user,uuid,mode,idlist){var param={user:user,uuid:uuid,mode:mode,idlist:idlist};var url=configurationProxy.serviceRoot()+'request/resubmit';var failMsg='Failed to '+mode+' request '+uuid;return post(done,fail,bc,url,failMsg,user,param)},downloadURL:function downloadURL(server,user,request,volume){var param={server:server,user:user,request:request,volume:volume};var url=configurationProxy.serviceRoot()+'request/download';if((typeof server==='undefined'?'undefined':_typeof(server))=='object')param=server;for(var p in param){if(param[p]===undefined)delete param[p]}return url+'?'+$.param(param)}}}

},{}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.default=function(){return new Promise(function(resolve,reject){try{window.stationSearchControl=new StationSearchControl("#wi-StationSearchControl");resolve()}catch(e){if(console.error!==wiConsole.error)console.error("station.js: "+e.message);wiConsole.error("station.js: "+e.message,e);reject()}})};var persistentNetwork=undefined;var persistentStation=undefined;function StationSearchControl(htmlTagId){var _controlDiv=null;var _dont_trigger=false;var _network_types=undefined;var _sensor_types=undefined;var _network_list=undefined;var _station_list=undefined;var _stream_list=undefined;function buildNetworkURL(start,end,networktype){var options={};if(typeof start!=="undefined"&&start!==null)options.start=start;if((typeof end==="undefined"?"undefined":_typeof(end))&&end!==null)options.end=end;if((typeof networktype==="undefined"?"undefined":_typeof(networktype))&&networktype!==null)options.networktype=networktype;return{url:_url_networks,options:options}}function buildStationURL(start,end,networktype,network){var options={};if(typeof start!=="undefined"&&start!==null)options.start=start;if((typeof end==="undefined"?"undefined":_typeof(end))&&end!==null)options.end=end;if((typeof networktype==="undefined"?"undefined":_typeof(networktype))&&networktype!==null)options.networktype=networktype;if((typeof network==="undefined"?"undefined":_typeof(network))&&network!==null)options.network=network;return{url:_url_stations,options:options}}function buildStreamURL(start,end,networktype,network,station){var options={};if(typeof start!=="undefined"&&start!==null)options.start=start;if((typeof end==="undefined"?"undefined":_typeof(end))&&end!==null)options.end=end;if((typeof networktype==="undefined"?"undefined":_typeof(networktype))&&networktype!==null)options.networktype=networktype;if((typeof network==="undefined"?"undefined":_typeof(network))&&network!==null)options.network=network;if((typeof station==="undefined"?"undefined":_typeof(station))&&station!==null)options.station=station;return{url:_url_streams,options:options}}function loadNetworkTypes(){if(_dont_trigger)return;if(interfaceLoader.debug())console.error("Load Networks Types");makeGenericSelect(_controlDiv.find("#sscNetworkTypeDiv"),"sscNetworkType","Loading ... ");wiService.metadata.networktypes(function(data){fillNetworkType(data);loadNetworkList()},null,true,{})}function loadSensorType(){if(_dont_trigger)return;if(interfaceLoader.debug())console.error("Load Sensor type");makeGenericSelect(_controlDiv.find("#sscSensorTypeDiv"),"sscSensorType","Loading ... ");wiService.metadata.sensortypes(fillSensorType,null,true,{})}function loadStreamList(){if(_dont_trigger)return;if(interfaceLoader.debug())console.error("Loading Stream List");makeMultiGenericSelect(_controlDiv.find("#sscStreamListDiv"),"sscStreamList","100px","Loading ...");var start=_controlDiv.find("#sscYear").slider("values",0);var end=_controlDiv.find("#sscYear").slider("values",1);var networktype=_controlDiv.find("#sscNetworkType option:selected").val();var network=_controlDiv.find("#sscNetworkList option:selected").val();var station=_controlDiv.find("#sscStationList option:selected").val();_stream_list=Array();wiService.metadata.streams(fillStreamList,function(){makeMultiGenericSelect(_controlDiv.find("#sscStreamListDiv"),"sscStreamList","100px","Failed to load data !")},true,start,end,networktype,network,station)}function loadStationList(){if(_dont_trigger)return;if(interfaceLoader.debug())console.error("Loading Station List");makeGenericSelect(_controlDiv.find("#sscStationListDiv"),"sscStationList","Loading ...");var start=_controlDiv.find("#sscYear").slider("values",0);var end=_controlDiv.find("#sscYear").slider("values",1);var networktype=_controlDiv.find("#sscNetworkType option:selected").val();var network=_controlDiv.find("#sscNetworkList option:selected").val();_station_list=Array();_stream_list=Array();wiService.metadata.stations(function(data){fillStationList(data);loadStreamList()},function(){makeGenericSelect(_controlDiv.find("#sscStationListDiv"),"sscStationList","Failed to load data !");makeMultiGenericSelect(_controlDiv.find("#sscStreamListDiv"),"sscStreamList","100px","Failed to load data !")},true,start,end,networktype,network)}function loadNetworkList(){if(_dont_trigger)return;if(interfaceLoader.debug())console.error("Loading Network List");persistentNetwork=_controlDiv.find("#sscNetworkList option:selected").val();persistentStation=_controlDiv.find("#sscStationList option:selected").val();makeGenericSelect(_controlDiv.find("#sscNetworkListDiv"),"sscNetworkList","Loading ... ");makeGenericSelect(_controlDiv.find("#sscStationListDiv"),"sscStationList","Loading ... ");makeMultiGenericSelect(_controlDiv.find("#sscStreamListDiv"),"sscStreamList","100px","Loading ... ");var start=_controlDiv.find("#sscYear").slider("values",0);var end=_controlDiv.find("#sscYear").slider("values",1);var networktype=_controlDiv.find("#sscNetworkType option:selected").val();_network_list=Array();_station_list=Array();_stream_list=Array();wiService.metadata.networks(function(data){fillNetworkList(data);loadStationList()},function(){makeGenericSelect(_controlDiv.find("#sscNetworkListDiv"),"sscNetworkList","Failed to load data !");makeGenericSelect(_controlDiv.find("#sscStationListDiv"),"sscStationList","Failed to load data !");makeMultiGenericSelect(_controlDiv.find("#sscStreamListDiv"),"sscStreamList","100px","Failed to load data !")},true,start,end,networktype)}function makeMultiGenericSelect(container,id,height,message){_controlDiv.find("#"+id).remove();var html="<select multiple=\"multiple\" id=\""+id+"\" style=\"width: 100%; height: "+height+";\">";html+="<option>"+message+"</option>";html+="</select>";container.append(html)}function makeMultiSelectFromArray(data,container,id,height){_controlDiv.find("#"+id).remove();var html="<select multiple=\"multiple\" id=\""+id+"\" style=\"width: 100%;\" height: "+height+";\">";var first="selected=\"selected\"";for(var key in data){var item=data[key];if(typeof item==="string"){html+="<option "+first+" value=\""+item+"\">"+item+"</option>"}else{html+="<option "+first+" value=\""+item[0]+"\">"+item[1]+"</option>"}first=""}html+="</select>";container.append(html)}function makeSelectFromArray(data,container,id){var ids=Array();_controlDiv.find("#"+id).remove();var html="";var first="selected=\"selected\"";html+="<select style='font-family: monospace; width: 100%;' id='"+id+"'>";for(var key in data){var item=data[key];html+="<option "+first+" value=\""+item[0]+"\">"+item[1].replace(/ /g,"&nbsp;")+"</option>";ids.push(item[0]);first=""}html+="</select>";container.append(html);return ids}function makeGenericSelect(container,id,message){_controlDiv.find("#"+id).remove();var html="<select style='font-family: monospace; width: 100%' id='"+id+"'>";html+="<option value=''>"+message+"</option>";html+="</select>";container.append(html)}function fillNetworkType(data){if(_controlDiv===null)return;if(!data)return;if(interfaceLoader.debug())console.error("Fill Netowrk Type");_network_types=data;var div=_controlDiv.find("#sscNetworkTypeDiv");makeSelectFromArray(_network_types,div,"sscNetworkType");_controlDiv.find("#sscNetworkType").bind("change",function(){loadNetworkList()});return}function fillSensorType(data){if(_controlDiv===null)return;if(!data)return;_sensor_types=data;if(interfaceLoader.debug())console.error("Fill Sensor Type");var div=_controlDiv.find("#sscSensorTypeDiv");makeSelectFromArray(_sensor_types,div,"sscSensorType");return}function fillNetworkList(data){if(_controlDiv===null)return;if(!data)return;if(interfaceLoader.debug())console.error("Fill Network");_network_list=data;var div=_controlDiv.find("#sscNetworkListDiv");makeSelectFromArray(_network_list,div,"sscNetworkList");_controlDiv.find("#sscNetworkList option[value=\""+persistentNetwork+"\"]").prop("selected",true);_controlDiv.find("#sscNetworkList").bind("change",function(){loadStationList()});return}function fillStationList(data){if(_controlDiv===null)return;if(!data)return;if(interfaceLoader.debug())console.error("Fill Station");_station_list=data;var div=_controlDiv.find("#sscStationListDiv");makeSelectFromArray(_station_list,div,"sscStationList");_controlDiv.find("#sscStationList option[value=\""+persistentStation+"\"]").prop("selected",true);persistentStation=_controlDiv.find("#sscStationList option:selected").val();_controlDiv.find("#sscStationList").bind("change",function(){loadStreamList()});return}function fillStreamList(data){if(_controlDiv===null)return;if(!data)return;if(interfaceLoader.debug())console.error("Fill Stream");var div=_controlDiv.find("#sscStreamListDiv");_stream_list=data;makeMultiSelectFromArray(_stream_list,div,"sscStreamList","100px");_controlDiv.find("#sscStreamList option").attr("selected","selected")}function reselectNetworkList(){if(_controlDiv===null)return;if(interfaceLoader.debug())console.error("Reselect network");var currentStation=_controlDiv.find("#sscStationList option:selected").val();var currentStationNet=currentStation.substr(0,12);_controlDiv.find("#sscNetworkList").val(currentStationNet)}function query(){if(_controlDiv===null)return;var start=undefined;var end=undefined;var networktype=undefined;var network=undefined;var station=undefined;var minlat=undefined;var maxlat=undefined;var minlon=undefined;var maxlon=undefined;var minradius=undefined;var maxradius=undefined;var minazimuth=undefined;var maxazimuth=undefined;var streams=undefined;var sensortype=undefined;var preferredsps=undefined;var events=undefined;start=_controlDiv.find("#sscYear").slider("values",0);end=_controlDiv.find("#sscYear").slider("values",1);networktype=_controlDiv.find("#sscNetworkType").val();network=_controlDiv.find("#sscNetworkList").val();var stationMode=_controlDiv.find("#sscStationSelectionMode input:checked").val();if(stationMode==="Code"){station=_controlDiv.find("#sscStationList").val()}else if(stationMode==="Region"){minlat=_controlDiv.find("#sscLatitudeMin").val();maxlat=_controlDiv.find("#sscLatitudeMax").val();minlon=_controlDiv.find("#sscLongitudeMin").val();maxlon=_controlDiv.find("#sscLongitudeMax").val()}else if(stationMode==="Events"){minradius=_controlDiv.find("#sscDistance").slider("values",0);maxradius=_controlDiv.find("#sscDistance").slider("values",1);minazimuth=_controlDiv.find("#sscAzimuth").slider("values",0);maxazimuth=_controlDiv.find("#sscAzimuth").slider("values",1)}var streamMode=_controlDiv.find("#sscStreamMode input:checked").val();if(streamMode==="Code"){streams=_controlDiv.find("#sscStreamList").val();if(!streams){alert("No channels selected");return}streams=streams.toString()}else if(streamMode==="Sps"){sensortype=_controlDiv.find("#sscSensorType").val();preferredsps=_controlDiv.find("#sscSamplingRate").slider("value")}if(stationMode==="Events"){try{if(!requestControl.hasEvent()){wiConsole.notice("Request has no events associated.");return}events=requestControl.eventLines();if(events.length===0){wiConsole.notice("Request has no events lines selected.");return}events=JSON.stringify(events)}catch(e){wiConsole.error(e.message);return}}wiService.metadata.query(function(data,statustext,jqxhr){if(jqxhr.status==204){alert("Got no stations for the selected day and options")}else{requestControl.appendStation(data);_controlDiv.find("#sscSearch").button("option","label","Append")}},null,true,start,end,network,networktype,station,sensortype,preferredsps,streams,minlat,maxlat,minlon,maxlon,minradius,maxradius,minazimuth,maxazimuth,events)}function resetCoordinates(){if(_controlDiv===null)return;_dont_trigger=true;_controlDiv.find("#sscLatitudeMin").val("-90");_controlDiv.find("#sscLatitudeMax").val("90");_controlDiv.find("#sscLongitudeMin").val("-180");_controlDiv.find("#sscLongitudeMax").val("180");if(mapControl.enabled())mapControl.clearSelect();_dont_trigger=false}function resetControl(){if(_controlDiv===null)return;_dont_trigger=true;_controlDiv.find("#sscAzimuth").slider("values",[0,360]);_controlDiv.find("#sscDistance").slider("values",[0,180]);var year=_controlDiv.find("#sscYear");year.slider("values",[year.slider("option","min"),year.slider("option","max")]);_controlDiv.find("#sscStationModeCatalog").click();_controlDiv.find("#sscStationSelectionModeCode").click();_controlDiv.find("#sscStreamModeCode").click();_controlDiv.find("#sscSamplingRate").slider("value",20);_dont_trigger=false;resetCoordinates();loadNetworkTypes();loadSensorType()}function validateCoordinates(){var bottom=_controlDiv.find("#sscLatitudeMin").val();var top=_controlDiv.find("#sscLatitudeMax").val();var left=_controlDiv.find("#sscLongitudeMin").val();var right=_controlDiv.find("#sscLongitudeMax").val();if(Number(bottom)>=Number(top)){alert("Invalid latitude interval.");return}if(mapControl.enabled())mapControl.setSelect(bottom,left,top,right)}function checkNumber(value,min,max){if(value==="")return null;value=Number(value);if(isNaN(value))return null;if(value<min)return null;if(value>max)return null;return value}function buildControl(){if(_controlDiv===null)return;var html="";html+="<h3>Station Information</h3>";html+="<div id=\"sscStationMode\" align=\"center\">";html+="<input type=\"radio\" value=\"Catalog\" id=\"sscStationModeCatalog\" name=\"sscStationMode\" /><label for=\"sscStationModeCatalog\">Browse Inventory</label>";html+="<input type=\"radio\" value=\"File\" id=\"sscStationModeFile\" name=\"sscStationMode\" /><label for=\"sscStationModeFile\">User Supplied</label>";html+="</div>";html+="<div id=\"sscStationDiv\">";html+="<div style=\"padding: 8px;\" id=\"sscStationCatalogDiv\"></div>";html+="<div style=\"padding: 8px; text-align: center;\" id=\"sscStationFileDiv\"></div>";html+="<div style=\"padding: 8px; text-align: center; background: pink;\" id=\"sscStationPresetDiv\">[CLICK HERE!]</div>";html+="</div>";_controlDiv.append(html);_controlDiv.find("#sscUserCatalog").button().bind("click",function(){$("#sscChannelLoader").dialog("open")});html="";html+="<h3>Networks</h3>";html+="<div class=\"wi-control-item-first\">";html+="<div class=\"wi-spacer\">Year from <u><span id=\"sscStart\"></span></u> to <u><span id=\"sscEnd\"></span></u>:</div>";html+="<div id=\"sscYear\"></div>";html+="</div>";html+="<div class='wi-control-item'>";html+="<div class='wi-spacer'>Network Type:</div>";html+="<div id='sscNetworkTypeDiv'></div>";html+="</div>";html+="<div class='wi-control-item'>";html+="<div class='wi-spacer'>Network Code:</div>";html+="<div id='sscNetworkListDiv'></div>";html+="* = temporary network; + = restricted access";html+="</div>";html+="<h3>Stations</h3>";html+="<div class='wi-control-item'>";html+="<div class=\"wi-spacer\" id=\"sscStationSelectionMode\" align=\"center\">";html+="<input type=\"radio\" value=\"Code\" id=\"sscStationSelectionModeCode\" name=\"sscStationSelectionMode\" /><label for=\"sscStationSelectionModeCode\">by Code</label>";html+="<input type=\"radio\" value=\"Region\" id=\"sscStationSelectionModeRegion\" name=\"sscStationSelectionMode\" /><label for=\"sscStationSelectionModeRegion\">by Region</label>";html+="<input type=\"radio\" value=\"Events\" id=\"sscStationSelectionModeEvents\" name=\"sscStationSelectionMode\" /><label for=\"sscStationSelectionModeEvents\">by Events</label>";html+="</div>";html+="<div id=\"sscStationSelectionDiv\">";html+="<div style=\"padding: 10px;\" id=\"sscStationSelectionCodeDiv\"></div>";html+="<div style=\"padding: 10px;\" id=\"sscStationSelectionRegionDiv\"></div>";html+="<div style=\"padding: 10px;\" id=\"sscStationSelectionEventsDiv\"></div>";html+="</div>";html+="</div>";html+="<h3>Streams</h3>";html+="<div class='wi-control-item'>";html+="<div id=\"sscStreamMode\" align=\"center\">";html+="<input type=\"radio\" value=\"Code\" id=\"sscStreamModeCode\" name=\"sscStreamMode\" /><label for=\"sscStreamModeCode\">by Code</label>";html+="<input type=\"radio\" value=\"Sps\" id=\"sscStreamModeSps\" name=\"sscStreamMode\" /><label for=\"sscStreamModeSps\">by Sampling</label>";html+="</div>";html+="<div id=\"sscStreamDiv\">";html+="<div style='padding: 10px;' id='sscStreamCodeDiv'></div>";html+="<div style=\"padding: 10px;\" id=\"sscStreamSpsDiv\"></div>";html+="</div>";html+="<div class=\"wi-control-item-last\">";html+="<input id=\"sscReset\" class=\"wi-inline\" type=\"button\" value=\"Reset\" />";html+="<input id=\"sscSearch\" class=\"wi-inline\" type=\"button\" value=\"Search\" />";html+="</div>";html+="</div>";_controlDiv.find("#sscStationCatalogDiv").append(html);requestControl.bind("onDeleteStations",function(){_controlDiv.find("#sscSearch").button("option","label","Search")});html="<div class=\"wi-spacer\">";var importURL=configurationProxy.serviceRoot()+"metadata/import";html+="<form id=\"importForm\" name=\"importForm\" action=\""+importURL+"\" target=\"importIframe\" method=\"post\" enctype=\"multipart/form-data\">";html+="<input type=\"file\" name=\"file\" value=\"\" class=\"wi-inline-full\" />";html+="<div style=\"padding: 8px; text-align: left;\" class=\"wi-spacer\"><br>You can upload <i>text</i> files in one of the following two formats:<ul><li>A list of stations previously saved here. (Use the \"Save Stations\"  button in the \"Event and Station List\").</li><li>A file retrieved from any FDSN compliant fdsnws-station Web Service in text format.</li></ul></div><br>";html+="<input id=\"sscSendList\" class=\"wi-inline\" type=\"submit\" value=\"Send List\" />";html+="</form>";html+="<iframe name=\"importIframe\" src=\"#\" style=\"display: none;\" ></iframe>";html+="</div>";_controlDiv.find("#sscStationFileDiv").append(html);_controlDiv.find("#importForm").submit(function(){var formdata=new FormData($(this)[0]);$.ajax({url:importURL,type:"POST",data:formdata,processData:false,encType:"multipart/form-data",contentType:false,success:function success(returndata,textStatus,jqxhr){if(jqxhr.status==204){alert("Got no stations from the uploaded file.\nHas the file the proper format?")}else{var data=returndata!==undefined?$.parseJSON(returndata):undefined;requestControl.appendStation(data)}},error:function error(){wiConsole.notice("Something went wrong with AJAX")}});return false});_controlDiv.find("#sscStationMode").buttonset();_controlDiv.find("#sscStationMode").change(function(item){_controlDiv.find("#sscStationDiv").children("div").hide();_controlDiv.find("#sscStation"+$(item.target).val()+"Div").show()});html="<div class=\"wi-spacer\">Filter stations by station code:</div>";html+="<div id=\"sscStationListDiv\"></div>";_controlDiv.find("#sscStationSelectionCodeDiv").append(html);html="<div class=\"wi-spacer\">Filter stations by region:</div>";html+="<div style=\"position: relative; text-align: center;\">";html+="N<br/>";html+="<input style=\"text-align: center; width: 50px; margin: .5em;\" id=\"sscLatitudeMax\" value=\"\" title=\"Northernmost latitude for the region of interest (-90&#176; to 90&#176;)\"><br/>";html+="W<input style=\"text-align: center; width: 50px; margin: .5em 1.5em .5em .5em;\" id=\"sscLongitudeMin\" value=\"\" title=\"Westernmost longitude for the region of interest (-180 to 180 degrees)\">";html+="<input style=\"text-align: center; width: 50px; margin: .5em .5em .5em 1.5em;\" id=\"sscLongitudeMax\" value=\"\" title=\"Easternmost longitude for the region of interest (-180&deg; to 180&deg;)\"/>E<br/>";html+="<input style=\"text-align: center; width: 50px; margin: .5em;\" id=\"sscLatitudeMin\" value=\"\" title=\"Southernmost latitude for the region of interest (-90&#176; to 90&#176;)\">";html+="<br/>S";html+="<input style=\"position: absolute; bottom: 2em; right: 0;\" type=\"button\" id=\"sscCoordinateReset\" value=\"Clear\" />";html+="</div>";_controlDiv.find("#sscStationSelectionRegionDiv").append(html);html="<div class=\"wi-spacer\">Filter stations by:</div>";html+="<div class=\"wi-spacer\">Event Distance (<u><span id=\"sscDistanceMin\"></span></u> to <u><span id=\"sscDistanceMax\"></span></u> degrees)</div>";html+="<div id=\"sscDistance\"></div>";html+="<br />";html+="<div class=\"wi-spacer\">Event Azimuth (<u><span id=\"sscAzimuthMin\"></span></u> to <u><span id=\"sscAzimuthMax\"></span></u> degrees)</div>";html+="<div id=\"sscAzimuth\"></div>";_controlDiv.find("#sscStationSelectionEventsDiv").append(html);html="<div>";html+="<div class=\"wi-spacer\">Choose the desired set of channels:<br />Use SHIFT and CTRL to extend the set.</div>";html+="<div id=\"sscStreamListDiv\"></div>";html+="</div>";_controlDiv.find("#sscStreamCodeDiv").append(html);html+="<div class='wi-spacer'>Sensor Type:</div>";html+="<div id='sscSensorTypeDiv'></div>";html+="<br />";html+="<div class=\"wi-spacer\">Target Sampling rate: <u><span id=\"sscSamplingRateValue\"></span></u> sps</div>";html+="<div class=\"wi-spacer\" id=\"sscSamplingRate\"></div>";_controlDiv.find("#sscStreamSpsDiv").append(html);_controlDiv.find("#sscSamplingRate").slider({min:0,max:150,step:1,slide:function slide(event,ui){_controlDiv.find("#sscSamplingRateValue").text(ui.value)},change:function change(event,ui){_controlDiv.find("#sscSamplingRateValue").text(ui.value)}});_controlDiv.find("#sscStreamMode").buttonset();_controlDiv.find("#sscStreamMode").change(function(item){_controlDiv.find("#sscStreamDiv").children("div").hide();_controlDiv.find("#sscStream"+$(item.target).val()+"Div").show()});_controlDiv.find("#sscStationSelectionMode").buttonset();_controlDiv.find("#sscStationSelectionMode").change(function(item){_controlDiv.find("#sscStationSelectionDiv").children("div").hide();_controlDiv.find("#sscStationSelection"+$(item.target).val()+"Div").show()});var today=new Date;_controlDiv.find("#sscYear").slider({range:true,min:1980,max:today.getFullYear(),step:1,slide:function slide(event,ui){_controlDiv.find("#sscStart").text(ui.values[0]);_controlDiv.find("#sscEnd").text(ui.values[1])},change:function change(event,ui){_controlDiv.find("#sscStart").text(ui.values[0]);_controlDiv.find("#sscEnd").text(ui.values[1]);loadNetworkList()}});_controlDiv.find("#sscStart").text(_controlDiv.find("#sscYear").slider("values",0));_controlDiv.find("#sscEnd").text(_controlDiv.find("#sscYear").slider("values",1));_controlDiv.find("#sscAzimuth").slider({range:true,min:0,max:360,step:1,values:[0,360],slide:function slide(event,ui){_controlDiv.find("#sscAzimuthMin").text(ui.values[0]);_controlDiv.find("#sscAzimuthMax").text(ui.values[1])},change:function change(event,ui){_controlDiv.find("#sscAzimuthMin").text(ui.values[0]);_controlDiv.find("#sscAzimuthMax").text(ui.values[1])}});_controlDiv.find("#sscAzimuthMin").text(_controlDiv.find("#sscAzimuth").slider("values",0));_controlDiv.find("#sscAzimuthMax").text(_controlDiv.find("#sscAzimuth").slider("values",1));_controlDiv.find("#sscDistance").slider({range:true,min:0,max:180,step:1,values:[0,180],slide:function slide(event,ui){_controlDiv.find("#sscDistanceMin").text(ui.values[0]);_controlDiv.find("#sscDistanceMax").text(ui.values[1])},change:function change(event,ui){_controlDiv.find("#sscDistanceMin").text(ui.values[0]);_controlDiv.find("#sscDistanceMax").text(ui.values[1])}});_controlDiv.find("#sscDistanceMin").text(_controlDiv.find("#sscDistance").slider("values",0));_controlDiv.find("#sscDistanceMax").text(_controlDiv.find("#sscDistance").slider("values",1));_controlDiv.find("input[id*=sscLatitude]").bind("change",function(item){var value=checkNumber($(item.target).val(),-90,90);if(value===null){alert("Invalid latitude value, "+$(item.target).val());$(item.target).val("");return}validateCoordinates()});_controlDiv.find("input[id*=sscLongitude]").bind("change",function(item){var value=checkNumber($(item.target).val(),-180,180);if(value===null){alert("Invalid longitude value, "+$(item.target).val());$(item.target).val("");return}validateCoordinates()});_controlDiv.find("#sscCoordinateReset").button().bind("click",resetCoordinates);_controlDiv.find("#sscReset").button().bind("click",resetControl);_controlDiv.find("#sscSearch").button().bind("click",query)}function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error("station.js: Cannot find a div with class '"+htmlTagId+"'");return}_controlDiv=control;buildControl();if(typeof mapControl!=="undefined"){mapControl.bind("onChangeExtend",function(bottom,left,top,right){_controlDiv.find("#sscLatitudeMax").val(top);_controlDiv.find("#sscLatitudeMin").val(bottom);_controlDiv.find("#sscLongitudeMax").val(right);_controlDiv.find("#sscLongitudeMin").val(left);_controlDiv.find("#sscStationSelectionModeRegion").prop("checked",true);_controlDiv.find("#sscStationSelectionModeRegion").button("refresh");_controlDiv.find("#sscStationSelectionDiv").children("div").hide();_controlDiv.find("#sscStationSelectionRegionDiv").show()})}resetControl()}load(htmlTagId)}

},{}],12:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){return new Promise(function(resolve,reject){try{window.submitControl=new SubmitControl("#wi-SubmitControl");resolve()}catch(e){if(console.error!==wiConsole.error)console.error("submit.js: "+e.message);wiConsole.error("submit.js: "+e.message,e);reject()}})};function SubmitControl(htmlTagId){var _controlDiv=null;function checkNumber(value,min,max){if(value==="")return null;value=Number(value);if(isNaN(value))return null;if(min&&value<min)return null;if(max&&value>max)return null;return value}function seconds2time(seconds){var value=new Date("2010-01-01T00:00:00Z");value.setSeconds(seconds);return value.toISOString().substr(11,8)}function time2seconds(time){var h=0;var m=0;var s=0;var hms=time.split(":");if(typeof hms[0]!=="undefined")h=Number(hms[0]);if(typeof hms[1]!=="undefined")m=Number(hms[1]);if(typeof hms[2]!=="undefined")s=Number(hms[2]);if(isNaN(h))return null;if(isNaN(m))return null;if(isNaN(s))return null;return(h*60+m)*60+s}function buildControl(){if(!_controlDiv)return;var html="";html+="<h3>Time Window selection:</h3>";html+="<div class=\"wi-control-item\">";html+="<div id=\"sbtTimeMode\" align=\"center\">";html+="<input type=\"radio\" value=\"Relative\" id=\"sbtTimeModeRelative\" name=\"sbtTimeMode\" /><label for=\"sbtTimeModeRelative\">Relative Mode</label>";html+="<input type=\"radio\" value=\"Absolute\" id=\"sbtTimeModeAbsolute\" name=\"sbtTimeMode\" /><label for=\"sbtTimeModeAbsolute\">Absolute Mode</label>";html+="</div>";html+="<div id=\"sbtTimeDiv\">";html+="<div style='padding: 10px;' id='sbtTimeAbsoluteDiv'></div>";html+="<div style=\"padding: 10px;\" id=\"sbtTimeRelativeDiv\"></div>";html+="</div>";html+="</div>";html+="<br/>";html+="<h3>Request Type:</h3>";if(typeof wiFDSNWS_Control.submitRequest!=="undefined"){html+="<div id=\"scType\">";html+="<div class='wi-control-item-first'>";html+="<div style=\"padding-left: 20px;\">";html+="<input id=\"scType-FDSNWS-dataselect\" name=\"scType\" type=\"radio\" value=\"FDSNWS-dataselect\" />&nbsp;<label for=\"scType-FDSNWS-dataselect\">Waveform (Mini-SEED)</label><br/>";html+="<input id=\"scType-FDSNWS-station-xml\" name=\"scType\" type=\"radio\" value=\"FDSNWS-station-xml\" />&nbsp;<label for=\"scType-FDSNWS-station-xml\">Metadata (StationXML)</label><br/>";html+="<input id=\"scType-FDSNWS-station-text\" name=\"scType\" type=\"radio\" value=\"FDSNWS-station-text\" />&nbsp;<label for=\"scType-FDSNWS-station-text\">Metadata (Text)</label><br/>";html+="</div>";html+="</div>";html+="</div>";html+="<div id=\"scLevel\">";html+="<div id=\"scLevelRespBlock\" style=\"display:none\">";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\"><a title=\"This will determine the amount of info returned.\">Metadata level?</a></div>";html+="<div style=\"padding-left: 20px;\">";html+="<input type=\"radio\" value=\"station\" id=\"scLevelResp-station\" name=\"scLevel\" />&nbsp;<label for=\"scLevelResp-station\">Station</label>";html+="<input type=\"radio\" value=\"channel\" id=\"scLevelResp-channel\" name=\"scLevel\" />&nbsp;<label for=\"scLevelResp-channel\">Channel</label>";html+="<input type=\"radio\" value=\"response\" id=\"scLevelResp-response\" name=\"scLevel\" />&nbsp;<label for=\"scLevelResp-response\">Response</label>";html+="</div>";html+="</div>";html+="</div>";html+="<div id=\"scLevelNoRespBlock\" style=\"display:none\">";html+="<div class=\"wi-control-item\">";html+="<div class=\"wi-spacer\"><a title=\"This will determine the amount of info returned.\">Metadata level?</a></div>";html+="<div style=\"padding-left: 20px;\">";html+="<input type=\"radio\" value=\"station\" id=\"scLevelNoResp-station\" name=\"scLevel\" />&nbsp;<label for=\"scLevelNoResp-station\">Station</label>";html+="<input type=\"radio\" value=\"channel\" id=\"scLevelNoResp-channel\" name=\"scLevel\" />&nbsp;<label for=\"scLevelNoResp-channel\">Channel</label>";html+="</div>";html+="</div>";html+="</div>";html+="</div>"}else{html+="<div class='wi-control-item-first'>";html+="<div class=\"wi-spacer\">Offline storage of the web browser must be enabled to use FDSNWS.</div>";html+="</div>"}html+="<div class=\"wi-control-item\">";html+="<input id=\"scReset\" class=\"wi-inline\" type=\"button\" value=\"Reset\"/>";html+="</div>";html+="<br/>";html+="<div class=\"wi-control-item-last\">";html+="<input id=\"scReview\" class=\"wi-inline\" type=\"button\" value=\"Review\"/>";html+="<input id=\"scSubmit\" class=\"wi-inline\" type=\"button\" value=\"Submit\"/>";html+="</div>";_controlDiv.empty();_controlDiv.append(html);html="<div class=\"wi-spacer\">Use time windows relative to events, by phase and onset time.</div>";html+="<div class=\"wi-control-item\">";html+="<div style=\"float: left;\">";html+="<div class=\"wi-spacer\" align=\"left\">Start <span style=\"font-size: 0.8em;\">(minutes before)</span></div>";html+="</div>";html+="<div style=\"clear: left; float: left;\">";html+="<select id=\"sbtPrePhase\" class=\"wi-inline\"></select>-";html+="</div>";html+="<div style=\"float: left;\">";html+="<div class=\"wi-spacer\"><input class=\"wi-inline\" id=\"sbtPreValue\" /></div>";html+="<div class=\"wi-spacer\"><div class=\"wi-inline\" id=\"sbtPreSlider\"></div></div>";html+="</div>";html+="<div style=\"clear: left; float: left;\">";html+="<div class=\"wi-spacer\" align=\"left\">End <span style=\"font-size: 0.8em;\">(minutes after)</span></div>";html+="</div>";html+="<div style=\"clear: left; float: left;\">";html+="<select id=\"sbtPostPhase\" class=\"wi-inline\"></select>+";html+="</div>";html+="<div style=\"float: left;\">";html+="<div class=\"wi-spacer\"><input class=\"wi-inline\" id=\"sbtPostValue\" /></div>";html+="<div class=\"wi-spacer\"><div class=\"wi-inline\" id=\"sbtPostSlider\"></div></div>";html+="</div>";html+="<br class=\"wi-clear\"/>";html+="</div>";_controlDiv.find("#sbtTimeRelativeDiv").append(html);html="<div class=\"wi-spacer\">Use an absolute time window.</div>";html+="<div class=\"wi-control\">";html+="<div style=\"float: left;\">";html+="<div class=\"wi-spacer\" align=\"center\">Start</div>";html+="<div class=\"wi-spacer\"><input style=\"position: relative; z-index: 2\" class=\"wi-inline\" id=\"sbtStartDate\" /></div>";html+="</div>";html+="<div style=\"float: right;\">";html+="<div class=\"wi-spacer\" align=\"center\">End</div>";html+="<div class=\"wi-spacer\"><input style=\"position: relative; z-index: 2\" class=\"wi-inline\" id=\"sbtEndDate\" /></div>";html+="</div>";html+="<div style=\"clear: left; float: left;\">";html+="<div class=\"wi-spacer\"><input class=\"wi-inline\" id=\"sbtStart\" maxlength=\"8\" /></div>";html+="<div class=\"wi-spacer\"><div class=\"wi-inline\" id=\"sbtStartSlider\"></div></div>";html+="</div>";html+="<div style=\"clear: right; float: right;\">";html+="<div class=\"wi-spacer\"><input class=\"wi-inline\" id=\"sbtEnd\" maxlength=\"8\"/></div>";html+="<div class=\"wi-spacer\"><div class=\"wi-inline\" id=\"sbtEndSlider\"></div></div>";html+="</div>";html+="<br class=\"wi-clear\"/>";html+="</div>";_controlDiv.find("#sbtTimeAbsoluteDiv").append(html);_controlDiv.find("#sbtTimeMode").buttonset();_controlDiv.find("#sbtTimeMode").change(function(item){_controlDiv.find("#sbtTimeDiv").children("div").hide();_controlDiv.find("#sbtTime"+$(item.target).val()+"Div").show()});_controlDiv.find("#sbtPreSlider").slider({min:-60,max:0,value:-2,slide:function slide(event,ui){_controlDiv.find("#sbtPreValue").val(Math.abs(ui.value))},change:function change(event,ui){_controlDiv.find("#sbtPreValue").val(Math.abs(ui.value))}});_controlDiv.find("#sbtPreValue").val(Math.abs(_controlDiv.find("#sbtPreSlider").slider("value")));_controlDiv.find("#sbtPreValue").bind("change",function(obj){var value=Number($(obj.target).val());if(isNaN(value)){alert("Invalid value, "+$(obj.target).val());$(obj.target).val(Math.abs($("#sbtPreSlider").slider("value")));return}_controlDiv.find("#sbtPreSlider").slider("value",-1*Math.abs(value))});_controlDiv.find("#sbtPostSlider").slider({min:0,max:3*60,value:10,slide:function slide(event,ui){_controlDiv.find("#sbtPostValue").val(ui.value)},change:function change(event,ui){_controlDiv.find("#sbtPostValue").val(ui.value)}});_controlDiv.find("#sbtPostValue").val(_controlDiv.find("#sbtPostSlider").slider("value"));_controlDiv.find("#sbtPostValue").bind("change",function(obj){var value=Number($(obj.target).val());if(isNaN(value)){alert("Invalid value, "+$(obj.target).val());$(obj.target).val($("#sbtPostSlider").slider("value"));return}_controlDiv.find("#sbtPostSlider").slider("value",Math.abs(value))});_controlDiv.find("#sbtStartDate").datepicker({showButtonPanel:true,changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd"});_controlDiv.find("#sbtStartSlider").slider({min:0,max:24*60*60-1,step:1,value:0,slide:function slide(event,ui){_controlDiv.find("#sbtStart").val(seconds2time(ui.value))},change:function change(event,ui){_controlDiv.find("#sbtStart").val(seconds2time(ui.value))}});_controlDiv.find("#sbtStart").val(seconds2time(_controlDiv.find("#sbtStartSlider").slider("value")));_controlDiv.find("#sbtStart").bind("change",function(obj){var value=time2seconds($(obj.target).val());if(value!==null)_controlDiv.find("#sbtStartSlider").slider("value",value);$(obj.target).val(seconds2time(_controlDiv.find("#sbtStartSlider").slider("value")))});_controlDiv.find("#sbtEndDate").datepicker({showButtonPanel:true,changeMonth:true,changeYear:true,dateFormat:"yy-mm-dd"});_controlDiv.find("#sbtEndSlider").slider({min:0,max:24*60*60-1,step:1,value:24*60*60-1,slide:function slide(event,ui){_controlDiv.find("#sbtEnd").val(seconds2time(ui.value))},change:function change(event,ui){_controlDiv.find("#sbtEnd").val(seconds2time(ui.value))}});_controlDiv.find("#sbtEnd").val(seconds2time(_controlDiv.find("#sbtEndSlider").slider("value")));_controlDiv.find("#sbtEnd").bind("change",function(obj){var value=time2seconds($(obj.target).val());if(value!==null)_controlDiv.find("#sbtEndSlider").slider("value",value);$(obj.target).val(seconds2time(_controlDiv.find("#sbtEndSlider").slider("value")))});_controlDiv.find("#scReset").button().bind("click",resetControl);_controlDiv.find("#scReview").button().bind("click",function(){submit(true)});_controlDiv.find("#scSubmit").button().bind("click",function(){submit(false)});requestControl.bind("onDeleteEvents",reselect);requestControl.bind("onAddEvents",reselect)}function reselect(){var mode=null;try{mode=requestControl.hasEvent()?"sbtTimeModeRelative":"sbtTimeModeAbsolute"}catch(e){mode="sbtTimeModeAbsolute"}_controlDiv.find("#"+mode).click()}function fillSelect(select,data){var html="";select.empty();for(var key in data){html+="<option value="+data[key][0]+">"+data[key][1]+"</option>"}select.append(html)}function resetControl(){if(!_controlDiv)return;var mode=null;try{mode=requestControl.hasEvent()?"sbtTimeModeRelative":"sbtTimeModeAbsolute"}catch(e){mode="sbtTimeModeAbsolute"}_controlDiv.find("#"+mode).click();_controlDiv.find("#sbtStartDate").datepicker("setDate","now");_controlDiv.find("#sbtEndDate").datepicker("setDate","now");_controlDiv.find("#sbtPreSlider").slider("value",-2);_controlDiv.find("#sbtPostSlider").slider("value",10);_controlDiv.find("#sbtStartSlider").slider("value",0);_controlDiv.find("#sbtEndSlider").slider("value",24*60*60-1);if(typeof wiFDSNWS_Control.submitRequest!=="undefined"){_controlDiv.find("input[name=scType]").bind("change",function(item){var key=$(item.target).val();if(key==="FDSNWS-station-xml"){_controlDiv.find("#scLevelResp-station").prop("checked",true);_controlDiv.find("#scLevelRespBlock").show()}else{_controlDiv.find("#scLevelRespBlock").hide()}if(key==="FDSNWS-station-text"){_controlDiv.find("#scLevelNoResp-station").prop("checked",true);_controlDiv.find("#scLevelNoRespBlock").show()}else{_controlDiv.find("#scLevelNoRespBlock").hide()}});_controlDiv.find("#scType-FDSNWS-dataselect").prop("checked",true);_controlDiv.find("#scLevelRespBlock").hide();_controlDiv.find("#scLevelNoRespBlock").hide()}wiService.metadata.phases(function(data){fillSelect(_controlDiv.find("#sbtPrePhase"),data);fillSelect(_controlDiv.find("#sbtPostPhase"),data)},null,true,{})}function submit(review){var submitinfo={};submitinfo.review=review;submitinfo.request={};submitinfo.timewindow={};_controlDiv.find(".wi-warn").removeClass("wi-warn");submitinfo.mode=_controlDiv.find("#sbtTimeMode input:checked").val();;submitinfo.request.requesttype=_controlDiv.find("#scType input:checked").val();submitinfo.request.level=_controlDiv.find("#scLevel input:checked").val();if(!submitinfo.request.requesttype){wiConsole.error("submit.js: request type is undefined");return}if(submitinfo.mode==="Absolute"){var sdate=_controlDiv.find("#sbtStartDate").datepicker("getDate");var edate=_controlDiv.find("#sbtEndDate").datepicker("getDate");var start=_controlDiv.find("#sbtStartSlider").slider("value");var end=_controlDiv.find("#sbtEndSlider").slider("value");submitinfo.timewindow.start=$.datepicker.formatDate("yy-mm-dd",sdate)+"T"+seconds2time(start)+"Z";submitinfo.timewindow.end=$.datepicker.formatDate("yy-mm-dd",edate)+"T"+seconds2time(end)+"Z"}else{submitinfo.timewindow.startphase=_controlDiv.find("#sbtPrePhase").val();submitinfo.timewindow.endphase=_controlDiv.find("#sbtPostPhase").val();submitinfo.timewindow.startoffset=_controlDiv.find("#sbtPreSlider").slider("value");submitinfo.timewindow.endoffset=_controlDiv.find("#sbtPostSlider").slider("value")}requestControl.submit(submitinfo)}function load(htmlTagId){var control=$(htmlTagId);if(control.length!==1){if(interfaceLoader.debug())console.error("submit.js: Cannot find a div with class '"+htmlTagId+"'");return}_controlDiv=control;buildControl();resetControl()}load(htmlTagId)}

},{}]},{},[6]);
